commit 7e536dee359bad64ea341d49671d610b075799f1
Author: Denis <benato.denis96@gmail.com>
Date:   Mon Jan 8 20:00:51 2024 +0100

    mt76: mt7921: Disable powersave features by default

commit cd607f2cbbbec90682b2f6d6b85e1525d0f43b19
Author: Felix Fietkau <nbd@nbd.name>
Date:   Fri Dec 8 08:50:04 2023 +0100

    wifi: mt76: fix crash with WED rx support enabled
    
    If WED rx is enabled, rx buffers are added to a buffer pool that can be
    filled from multiple page pools. Because buffers freed from rx poll are
    not guaranteed to belong to the processed queue's page pool, lockless
    caching must not be used in this case.
    
    Cc: stable@vger.kernel.org
    Fixes: 2f5c3c77fc9b ("wifi: mt76: switch to page_pool allocator")
    Signed-off-by: Felix Fietkau <nbd@nbd.name>
    Acked-by: Lorenzo Bianconi <lorenzo@kernel.org>
    Signed-off-by: Kalle Valo <kvalo@kernel.org>
    Link: https://lore.kernel.org/r/20231208075004.69843-1-nbd@nbd.name

commit 7a934b5cc3f452df6f9a4903450fc103dee98ee8
Author: Ming Yen Hsieh <mingyen.hsieh@mediatek.com>
Date:   Mon Oct 30 15:17:34 2023 +0800

    wifi: mt76: mt7921: fix 6GHz disabled by the missing default CLC config
    
    No matter CLC is enabled or disabled, the driver should initialize
    the default value 0xff for channel configuration of CLC. Otherwise,
    the zero value would disable channels.
    
    Reported-and-tested-by: Ben Greear <greearb@candelatech.com>
    Closes: https://lore.kernel.org/all/2fb78387-d226-3193-8ca7-90040561b9ad@candelatech.com/
    Fixes: 09382d8f8641 ("wifi: mt76: mt7921: update the channel usage when the regd domain changed")
    Signed-off-by: Ming Yen Hsieh <mingyen.hsieh@mediatek.com>
    Signed-off-by: Deren Wu <deren.wu@mediatek.com>
    Signed-off-by: Kalle Valo <kvalo@kernel.org>
    Link: https://lore.kernel.org/r/5a976ddf1f636b5cb809373501d3cfdc6d8de3e4.1698648737.git.deren.wu@mediatek.com

commit 09d96ee5674a0eaa800c664353756ecc45c4a87f
Author: Yunsheng Lin <linyunsheng@huawei.com>
Date:   Fri Oct 20 17:59:49 2023 +0800

    page_pool: remove PP_FLAG_PAGE_FRAG
    
    PP_FLAG_PAGE_FRAG is not really needed after pp_frag_count
    handling is unified and page_pool_alloc_frag() is supported
    in 32-bit arch with 64-bit DMA, so remove it.
    
    Signed-off-by: Yunsheng Lin <linyunsheng@huawei.com>
    CC: Lorenzo Bianconi <lorenzo@kernel.org>
    CC: Alexander Duyck <alexander.duyck@gmail.com>
    CC: Liang Chen <liangchen.linux@gmail.com>
    CC: Alexander Lobakin <aleksander.lobakin@intel.com>
    Link: https://lore.kernel.org/r/20231020095952.11055-3-linyunsheng@huawei.com
    Signed-off-by: Jakub Kicinski <kuba@kernel.org>

commit 169b7acb847e8dc656cd2289a91ff668f72405a0
Author: Ming Yen Hsieh <mingyen.hsieh@mediatek.com>
Date:   Wed Oct 18 12:29:35 2023 +0800

    wifi: mt76: mt7921: fix kernel panic by accessing invalid 6GHz channel info
    
    When the chip not support 6GHz capability, the channels of 6GHz information
    should not be updated. This caused a crash:
    
    [   19.442078] Unable to handle kernel NULL pointer dereference at virtual address 0000000000000014
    [   19.457535] Mem abort info:
    [   19.465329]   ESR = 0x0000000096000004
    [   19.473295]   EC = 0x25: DABT (current EL), IL = 32 bits
    [   19.482354]   SET = 0, FnV = 0
    [   19.489143]   EA = 0, S1PTW = 0
    [   19.495991]   FSC = 0x04: level 0 translation fault
    [   19.504554] Data abort info:
    [   19.511111]   ISV = 0, ISS = 0x00000004, ISS2 = 0x00000000
    [   19.520269]   CM = 0, WnR = 0, TnD = 0, TagAccess = 0
    [   19.528988]   GCS = 0, Overlay = 0, DirtyBit = 0, Xs = 0
    [   19.537960] user pgtable: 4k pages, 48-bit VAs, pgdp=00000001027a9000
    [   19.548014] [0000000000000014] pgd=0000000000000000, p4d=000000000000
    [   19.558429] Internal error: Oops: 0000000096000004 [#1] PREEMPT SMP
    [   19.568270] Modules linked in: mt7921e mt7921_common mt792x_lib
    mt76_connac_lib mt76 mac80211 btusb btintel cfg80211 btmtk snd_sof_ipc_msg_
    btrtl snd_sof_ipc_flood_test btbcm bluetooth snd_sof_mt8195 uvcvideo
    mtk_adsp_common snd_sof_xtensa_dsp uvc snd_sof_of snd_sof videobuf2_vmalloc
    ecdh_generic ecc snd_sof_utils cros_ec_lid_angle cros_ec_sensors crct10dif_
    cros_ec_sensors_core cros_usbpd_logger crypto_user fuse ip_tables ipv6
    [   19.614237] CPU: 1 PID: 105 Comm: kworker/1:1 Not tainted 6.6.0-rc6-next-20231017+ #324
    [   19.625957] Hardware name: Acer Tomato (rev2) board (DT)
    [   19.634970] Workqueue: events mt7921_init_work [mt7921_common]
    [   19.644522] pstate: 60400009 (nZCv daif +PAN -UAO -TCO -DIT -SSBS BTY
    [   19.655182] pc : mt7921_regd_notifier+0x180/0x290 [mt7921_common]
    [   19.664983] lr : mt7921_regd_notifier+0xd4/0x290 [mt7921_common]
    [   19.674679] sp : ffff800080acba80
    [   19.681649] x29: ffff800080acba80 x28: 0000000000000000 x27: ffff4faf
    [   19.692483] x26: 0000000000000000 x25: 0000000000000000 x24: ffff4faf
    [   19.703294] x23: 00000000ffffe926 x22: ffff4faf16031fa0 x21: 00000000
    [   19.714108] x20: 000000000000001c x19: ffff4faf16ba6f40 x18: 00000000
    [   19.724928] x17: 0000000000000000 x16: ffffac6b891c2750 x15: ffff8000
    [   19.735722] x14: 0000000000000180 x13: 0000000000000000 x12: 00000000
    [   19.746478] x11: 0000000000000002 x10: ffff4faf01c21780 x9 : ffffac6b
    [   19.757214] x8 : 00000000006c0000 x7 : ffffac6b6b020cf0 x6 : ffffac6b
    [   19.767945] x5 : ffffac6b6b020d00 x4 : ffffac6b6b020cf8 x3 : ffff4faf
    [   19.778648] x2 : 0000000000000000 x1 : 000000000000001c x0 : 00000000
    [   19.789366] Call trace:
    [   19.795381]  mt7921_regd_notifier+0x180/0x290 [mt7921_common]
    [   19.804675]  wiphy_update_regulatory+0x2bc/0xa08 [cfg80211]
    [   19.813864]  wiphy_regulatory_register+0x4c/0x88 [cfg80211]
    [   19.823029]  wiphy_register+0x75c/0x8d0 [cfg80211]
    [   19.831446]  ieee80211_register_hw+0x70c/0xc10 [mac80211]
    [   19.840479]  mt76_register_device+0x168/0x2e8 [mt76]
    [   19.849008]  mt7921_init_work+0xdc/0x250 [mt7921_common]
    [   19.857817]  process_one_work+0x148/0x3c0
    [   19.865292]  worker_thread+0x32c/0x450
    [   19.872489]  kthread+0x11c/0x128
    [   19.879173]  ret_from_fork+0x10/0x20
    [   19.886153] Code: f0000041 9100a021 94000aef aa0003f9 (b9401780)
    [   19.895634] ---[ end trace 0000000000000000 ]---
    
    Reported-by: AngeloGioacchino Del Regno <angelogioacchino.delregno@collabora.com>
    Closes: https://lore.kernel.org/all/927e7d50-826d-4c92-9931-3c59b18c6945@collabora.com/
    Fixes: 09382d8f8641 ("wifi: mt76: mt7921: update the channel usage when the regd domain changed")
    Signed-off-by: Ming Yen Hsieh <mingyen.hsieh@mediatek.com>
    Signed-off-by: Deren Wu <deren.wu@mediatek.com>
    Tested-by: AngeloGioacchino Del Regno <angelogioacchino.delregno@collabora.com>
    Reviewed-by: AngeloGioacchino Del Regno <angelogioacchino.delregno@collabora.com>
    Signed-off-by: Kalle Valo <kvalo@kernel.org>
    Link: https://lore.kernel.org/r/cf77a58a60d81c77a28388bc8d312b87ffb48434.1697603002.git.deren.wu@mediatek.com

commit bd94d501c0c99753497f8396e96738a560bac10e
Author: Kees Cook <keescook@chromium.org>
Date:   Fri Sep 15 13:06:12 2023 -0700

    wifi: mt76: Annotate struct mt76_rx_tid with __counted_by
    
    Prepare for the coming implementation by GCC and Clang of the __counted_by
    attribute. Flexible array members annotated with __counted_by can have
    their accesses bounds-checked at run-time checking via CONFIG_UBSAN_BOUNDS
    (for array indexing) and CONFIG_FORTIFY_SOURCE (for strcpy/memcpy-family
    functions).
    
    As found with Coccinelle[1], add __counted_by for struct mt76_rx_tid.
    
    [1] https://github.com/kees/kernel-tools/blob/trunk/coccinelle/examples/counted_by.cocci
    
    Cc: Felix Fietkau <nbd@nbd.name>
    Cc: Lorenzo Bianconi <lorenzo@kernel.org>
    Cc: Ryder Lee <ryder.lee@mediatek.com>
    Cc: Shayne Chen <shayne.chen@mediatek.com>
    Cc: Sean Wang <sean.wang@mediatek.com>
    Cc: Kalle Valo <kvalo@kernel.org>
    Cc: Matthias Brugger <matthias.bgg@gmail.com>
    Cc: AngeloGioacchino Del Regno <angelogioacchino.delregno@collabora.com>
    Cc: linux-wireless@vger.kernel.org
    Cc: linux-arm-kernel@lists.infradead.org
    Cc: linux-mediatek@lists.infradead.org
    Signed-off-by: Kees Cook <keescook@chromium.org>
    Reviewed-by: Gustavo A. R. Silva <gustavoars@kernel.org>
    Signed-off-by: Felix Fietkau <nbd@nbd.name>

commit 09382d8f8641bc12fffc41a93eb9b37be0e653c0
Author: Ming Yen Hsieh <mingyen.hsieh@mediatek.com>
Date:   Sat Sep 30 10:25:09 2023 +0800

    wifi: mt76: mt7921: update the channel usage when the regd domain changed
    
    The 5.9/6GHz channel license of a certain platform device has been
    regulated in various countries. That may be difference with standard
    Liunx regulatory domain settings. In this case, when .reg_notifier()
    called for regulatory change, mt792x chipset should update the channel
    usage based on clc or dts configurations.
    
    Channel would be disabled by following cases.
    * clc report the particular UNII-x is disabled.
    * dts enabled and the channel is not configured.
    
    Signed-off-by: Ming Yen Hsieh <mingyen.hsieh@mediatek.com>
    Co-developed-by: Deren Wu <deren.wu@mediatek.com>
    Signed-off-by: Deren Wu <deren.wu@mediatek.com>
    Signed-off-by: Felix Fietkau <nbd@nbd.name>

commit 4fc8df50fd41c2762d893211487be0ecb24c6a05
Author: Ming Yen Hsieh <mingyen.hsieh@mediatek.com>
Date:   Sat Sep 30 10:25:08 2023 +0800

    wifi: mt76: mt7921: get regulatory information from the clc event
    
    The clc event can report the radio configuration for the corresponding
    country and the driver would take it as regulatory information of a
    certain platform device.
    
    This patch would change the clc commnad from no-waiting to waiting for
    event. For backward compatible, we also add a new nic capability tag
    to indicate the firmware did support this new clc event from now on.
    
    Signed-off-by: Ming Yen Hsieh <mingyen.hsieh@mediatek.com>
    Co-developed-by: Deren Wu <deren.wu@mediatek.com>
    Signed-off-by: Deren Wu <deren.wu@mediatek.com>
    Signed-off-by: Felix Fietkau <nbd@nbd.name>

commit 51ba0e3a15eb1643116a93674e230e11b9499592
Author: Ming Yen Hsieh <mingyen.hsieh@mediatek.com>
Date:   Sat Sep 30 10:25:07 2023 +0800

    wifi: mt76: mt7921: add 6GHz power type support for clc
    
    There are several power type should be supported in 6GHz band. mt7921
    apply 6GHz power type from AP settings and clc will setup the
    corresponding regulatory power.
    
    Signed-off-by: Ming Yen Hsieh <mingyen.hsieh@mediatek.com>
    Co-developed-by: Deren Wu <deren.wu@mediatek.com>
    Signed-off-by: Deren Wu <deren.wu@mediatek.com>
    Signed-off-by: Felix Fietkau <nbd@nbd.name>

commit 7801da3388567c78f79d5ed96a5527de264fdef7
Author: Ming Yen Hsieh <mingyen.hsieh@mediatek.com>
Date:   Sat Sep 30 10:25:06 2023 +0800

    wifi: mt76: mt7921: enable set txpower for UNII-4
    
    support power config for channel 165/173/177
    
    Signed-off-by: Ming Yen Hsieh <mingyen.hsieh@mediatek.com>
    Signed-off-by: Felix Fietkau <nbd@nbd.name>

commit dab35009fc1c6dc1598e832016594161988d8f68
Author: Deren Wu <deren.wu@mediatek.com>
Date:   Sat Sep 30 10:25:05 2023 +0800

    wifi: mt76: mt7921: move connac nic capability handling to mt7921
    
    mt76_connac_mcu_get_nic_capability() is used by mt7921 only. It
    would be better to put the code in chip folder. And we can provide
    more chip capability information in mt792x_phy without making
    mt76_phy much bigger.
    
    The three functions would be moved to mt7921 folder and renamed.
    mt76_connac_mcu_parse_tx_resource()
    mt76_connac_mcu_parse_phy_cap()
    mt76_connac_mcu_get_nic_capability()
    
    Signed-off-by: Deren Wu <deren.wu@mediatek.com>
    Signed-off-by: Felix Fietkau <nbd@nbd.name>

commit ef444ad00474bc5ebbcd4f6a2ea87f6fbe7977ce
Author: Sean Wang <sean.wang@mediatek.com>
Date:   Wed Sep 27 06:20:25 2023 +0800

    wifi: mt76: reduce spin_lock_bh held up in mt76_dma_rx_cleanup
    
    mt76_dma_rx_cleanup would be frequenetly called up to reset the dma rings
    to be freshed as new ones when switching back from the deep sleep mode to
    the active mode on mt7921 and mt7922.
    
    Shrink the scope of spin_lock_bh in mt76_dma_rx_cleanup being held up
    to allow the kernel scheduler to be able to switch other tasks in time
    by reducing the latency.
    
    Signed-off-by: Sean Wang <sean.wang@mediatek.com>
    Signed-off-by: Felix Fietkau <nbd@nbd.name>

commit adde3eed4a75fe346d5ec1d78cd117e06bd70404
Author: Yi-Chia Hsieh <yi-chia.hsieh@mediatek.com>
Date:   Thu Sep 21 14:04:01 2023 -0700

    wifi: mt76: mt7996: Add mcu commands for getting sta tx statistic
    
    Per peer Tx/Rx statistic can only be obtained by querying WM when WED is
    on. This patch switches to periodic event reporting in the case of WED
    being enabled.
    
    Signed-off-by: Yi-Chia Hsieh <yi-chia.hsieh@mediatek.com>
    Signed-off-by: Money Wang <Money.Wang@mediatek.com>
    Signed-off-by: Peter Chiu <chui-hao.chiu@mediatek.com>
    Signed-off-by: Evelyn Tsai <evelyn.tsai@mediatek.com>
    Signed-off-by: Ryder Lee <ryder.lee@mediatek.com>
    Signed-off-by: Felix Fietkau <nbd@nbd.name>

commit 5ab7d466c4ace74ac46808ff6468f9a34ca0b350
Author: Lorenzo Bianconi <lorenzo@kernel.org>
Date:   Thu Sep 21 12:23:48 2023 +0200

    wifi: mt76: mt792x: move some common usb code in mt792x module
    
    Move the following shared usb routines in mt792x module:
    - mt792xu_stop
    - mt792x_stop
    
    Signed-off-by: Lorenzo Bianconi <lorenzo@kernel.org>
    Signed-off-by: Felix Fietkau <nbd@nbd.name>

commit 4d2cb56afaf7a96f04bab4c03506e4f5ad8f03db
Author: Lorenzo Bianconi <lorenzo@kernel.org>
Date:   Thu Sep 21 12:23:47 2023 +0200

    wifi: mt76: mt792x: move mt7921_skb_add_usb_sdio_hdr in mt792x module
    
    Since mt7921_skb_add_usb_sdio_hdr is shared between mt7925 and mt7921
    drivers, move it in mt792x module.
    
    Signed-off-by: Lorenzo Bianconi <lorenzo@kernel.org>
    Signed-off-by: Felix Fietkau <nbd@nbd.name>

commit 81af5418049ff673ddad0ba9377230bdb13a1f24
Author: Felix Fietkau <nbd@nbd.name>
Date:   Mon Mar 20 20:47:04 2023 +0100

    wifi: mt76: mt7915 add tc offloading support
    
    This is used for offloading flows from WLAN to Ethernet, or from WLAN to WLAN
    
    Signed-off-by: Felix Fietkau <nbd@nbd.name>

commit c948b5da6bbec742b433138e3e3f9537a85af2e5
Author: Deren Wu <deren.wu@mediatek.com>
Date:   Mon Sep 18 17:30:54 2023 +0800

    wifi: mt76: mt7925: add Mediatek Wi-Fi7 driver for mt7925 chips
    
    Add mt7925, a new mac80211 driver for the MediaTek Wi-Fi 7 (802.11be) device
    Filogic 360, which can support Station, AP, P2P, and monitor modes.
    Filogic 360 supports max 4096-QAM/160MHz radio operation at 6 GHz, 5 GHz,
    or 2.4 GHz with 2x2 antennas. This chip supports PCIe and USB bus type.
    
    mt7925 supports Wi-Fi 6E and EHT rate with single link only at this moment,
    whereas Wi-Fi 7 and its specific features are working in progress. They will be
    introduced in further patches.
    
    The driver is build tested by Intel's kernel test robot with both GCC and Clang
    with several architecture. Sparse reports no warnings.
    
    There are multiple authors, they are listed in alphabetical order below.
    
    Co-developed-by: Hao Zhang <hao.zhang@mediatek.com>
    Signed-off-by: Hao Zhang <hao.zhang@mediatek.com>
    Co-developed-by: Leon Yen <leon.yen@mediatek.com>
    Signed-off-by: Leon Yen <leon.yen@mediatek.com>
    Co-developed-by: Lorenzo Bianconi <lorenzo@kernel.org>
    Signed-off-by: Lorenzo Bianconi <lorenzo@kernel.org>
    Co-developed-by: Mingyen Hsieh <mingyen.hsieh@mediatek.com>
    Signed-off-by: Mingyen Hsieh <mingyen.hsieh@mediatek.com>
    Co-developed-by: Nelson Yu <nelson.yu@mediatek.com>
    Signed-off-by: Nelson Yu <nelson.yu@mediatek.com>
    Co-developed-by: Quan Zhou <quan.zhou@mediatek.com>
    Signed-off-by: Quan Zhou <quan.zhou@mediatek.com>
    Co-developed-by: Rong Yan <rong.yan@mediatek.com>
    Signed-off-by: Rong Yan <rong.yan@mediatek.com>
    Signed-off-by: Deren Wu <deren.wu@mediatek.com>
    Signed-off-by: Felix Fietkau <nbd@nbd.name>

commit c558d22e7a93affeb18aae1dcd777ddd1ad18da1
Author: Sean Wang <sean.wang@mediatek.com>
Date:   Mon Sep 18 16:03:08 2023 +0800

    wifi: mt76: mt7921: fix the wrong rate selected in fw for the chanctx driver
    
    The variable band should be determined by the ieee80211_chanctx_conf when
    the driver is a kind of chanctx one e.g mt7921 and mt7922 driver so we
    added the extension to mt76_connac2_mac_tx_rate_val and
    mt76_connac_get_he_phy_cap for the firmware can select the proper rate.
    
    Fixes: 41ac53c899bd ("wifi: mt76: mt7921: introduce chanctx support")
    Signed-off-by: Sean Wang <sean.wang@mediatek.com>
    Tested-by: David Ruth <druth@chromium.org>
    Signed-off-by: Deren Wu <deren.wu@mediatek.com>
    Signed-off-by: Felix Fietkau <nbd@nbd.name>

commit 32b1000db221df33ec8b57794a091ba6075b6c28
Author: Sean Wang <sean.wang@mediatek.com>
Date:   Mon Sep 18 16:03:07 2023 +0800

    wifi: mt76: mt7921: fix the wrong rate pickup for the chanctx driver
    
    The variable band should be determined by the ieee80211_chanctx_conf when
    the driver is a kind of chanctx one e.g mt7921 and mt7922 driver so we
    added the extension to mt76_connac2_mac_tx_rate_val by distinguishing if
    it can support chanctx to fix the incorrect rate pickup.
    
    Fixes: 41ac53c899bd ("wifi: mt76: mt7921: introduce chanctx support")
    Signed-off-by: Sean Wang <sean.wang@mediatek.com>
    Reviewed-by: David Ruth <druth@chromium.org>
    Tested-by: David Ruth <druth@chromium.org>
    Signed-off-by: Deren Wu <deren.wu@mediatek.com>
    Signed-off-by: Felix Fietkau <nbd@nbd.name>

commit f50206555992abb802cee4e3f951d1ea669cb8bc
Author: Sean Wang <sean.wang@mediatek.com>
Date:   Mon Sep 18 16:03:06 2023 +0800

    wifi: mt76: move struct ieee80211_chanctx_conf up to struct mt76_vif
    
    Move struct ieee80211_chanctx_conf up to struct mt76_vif to allow the
    connac2 library can access the struct ieee80211_chanctx_conf * member in
    struct mt76_vif.
    
    Signed-off-by: Sean Wang <sean.wang@mediatek.com>
    Reviewed-by: David Ruth <druth@chromium.org>
    Tested-by: David Ruth <druth@chromium.org>
    Signed-off-by: Deren Wu <deren.wu@mediatek.com>
    Signed-off-by: Felix Fietkau <nbd@nbd.name>

commit 1f39e1d95a210ac98422b5111962f9bb9f2428a4
Author: Jinjie Ruan <ruanjinjie@huawei.com>
Date:   Sun Sep 3 11:02:16 2023 +0800

    wifi: mt76: Drop unnecessary error check for debugfs_create_dir()
    
    debugfs_create_dir() returns ERR_PTR and never return NULL.
    
    As Russell suggested, this patch removes the error checking for
    debugfs_create_dir(). This is because the DebugFS kernel API is developed
    in a way that the caller can safely ignore the errors that occur during
    the creation of DebugFS nodes. The debugfs APIs have a IS_ERR() judge in
    start_creating() which can handle it gracefully. So these checks are
    unnecessary.
    
    Fixes: 17f1de56df05 ("mt76: add common code shared between multiple chipsets")
    Signed-off-by: Jinjie Ruan <ruanjinjie@huawei.com>
    Suggested-by: Russell King (Oracle) <linux@armlinux.org.uk>
    Signed-off-by: Felix Fietkau <nbd@nbd.name>

commit ced1a0b8f3944e44e7f4eb3772dea1bada25d38a
Author: MeiChia Chiu <meichia.chiu@mediatek.com>
Date:   Thu Aug 31 14:22:21 2023 +0800

    wifi: mt76: mt7915: fix beamforming availability check
    
    Without this patch, when ap sets the tx stream number to 2,
    ap won't send any beamforming packet.
    
    Fixes: f89f297aef28 ("mt76: mt7915: fix txbf starec TLV issues")
    Signed-off-by: MeiChia Chiu <meichia.chiu@mediatek.com>
    Signed-off-by: Shayne Chen <shayne.chen@mediatek.com>
    Signed-off-by: Felix Fietkau <nbd@nbd.name>

commit 3d5a42905a7299a1b36052eabc127e6e8dbaca47
Author: Peter Chiu <chui-hao.chiu@mediatek.com>
Date:   Thu Aug 31 14:22:20 2023 +0800

    wifi: mt76: mt7915: update mpdu density capability
    
    Set mpdu density to 2 usec for non-mt7915 Wi-Fi 6 generation chipsets
    to align to the hardware capability which improves the throughput.
    
    Signed-off-by: Peter Chiu <chui-hao.chiu@mediatek.com>
    Signed-off-by: Shayne Chen <shayne.chen@mediatek.com>
    Signed-off-by: Felix Fietkau <nbd@nbd.name>

commit 8234324ae90948a4e5bfaebe042c51c400cf017a
Author: Peter Chiu <chui-hao.chiu@mediatek.com>
Date:   Thu Aug 31 14:22:19 2023 +0800

    wifi: mt76: check vif type before reporting cca and csa
    
    Do not report cca and csa finish to upper layer on station type vif to
    prevent warnings caused by setting beacon.
    
    Signed-off-by: Peter Chiu <chui-hao.chiu@mediatek.com>
    Signed-off-by: Shayne Chen <shayne.chen@mediatek.com>
    Signed-off-by: Felix Fietkau <nbd@nbd.name>

commit c685034cabc574dbdf16fa675010e202083cb4c2
Author: Shayne Chen <shayne.chen@mediatek.com>
Date:   Thu Aug 31 14:22:18 2023 +0800

    wifi: mt76: fix per-band IEEE80211_CONF_MONITOR flag comparison
    
    Use the correct ieee80211_conf of each band for IEEE80211_CONF_MONITOR
    comparison.
    
    Fixes: 24e69f6bc3ca ("mt76: fix monitor rx FCS error in DFS channel")
    Fixes: 98686cd21624 ("wifi: mt76: mt7996: add driver for MediaTek Wi-Fi 7 (802.11be) devices")
    Signed-off-by: Shayne Chen <shayne.chen@mediatek.com>
    Signed-off-by: Felix Fietkau <nbd@nbd.name>

commit 413f05d68d11981f5984b49214d3a5a0d88079b1
Author: StanleyYP Wang <StanleyYP.Wang@mediatek.com>
Date:   Thu Aug 31 14:22:17 2023 +0800

    wifi: mt76: get rid of false alamrs of tx emission issues
    
    When the set_chan_info command is set with CH_SWITCH_NORMAL reason,
    even if the action is UNI_CHANNEL_RX_PATH, it'll still generate some
    unexpected tones, which might confuse DFS CAC tests that there are some
    tone leakages. To get rid of these kinds of false alarms, always bypass
    DPD calibration when IEEE80211_CONF_IDLE is set.
    
    Reviewed-by: Evelyn Tsai <evelyn.tsai@mediatek.com>
    Signed-off-by: StanleyYP Wang <StanleyYP.Wang@mediatek.com>
    Signed-off-by: Shayne Chen <shayne.chen@mediatek.com>
    Signed-off-by: Felix Fietkau <nbd@nbd.name>

commit d6a2f91741d9f43b31cb16c82da37f35117a6d1c
Author: Bo Jiao <Bo.Jiao@mediatek.com>
Date:   Thu Aug 31 14:22:16 2023 +0800

    wifi: mt76: fix potential memory leak of beacon commands
    
    Fix potential memory leak when setting beacon and inband discovery
    commands.
    
    Fixes: e57b7901469f ("mt76: add mac80211 driver for MT7915 PCIe-based chipsets")
    Fixes: 98686cd21624 ("wifi: mt76: mt7996: add driver for MediaTek Wi-Fi 7 (802.11be) devices")
    Signed-off-by: Bo Jiao <Bo.Jiao@mediatek.com>
    Signed-off-by: Shayne Chen <shayne.chen@mediatek.com>
    Signed-off-by: Felix Fietkau <nbd@nbd.name>

commit aad094be9f442a5d6dc72626594ff687749dfbf9
Author: Allen Ye <allen.ye@mediatek.com>
Date:   Thu Aug 31 14:22:15 2023 +0800

    wifi: mt76: check sta rx control frame to multibss capability
    
    Add CAP3_RX_CTRL_FRAME_TO_MULTIBSS check when setting sta_muru_tlv,
    which is used to get stations's capability of receiving control frames
    when running OFDMA with MBSSIDs.
    
    Signed-off-by: Allen Ye <allen.ye@mediatek.com>
    Signed-off-by: Shayne Chen <shayne.chen@mediatek.com>
    Signed-off-by: Felix Fietkau <nbd@nbd.name>

commit de869f81f994c4a4dea0d70921ac5ab78858b224
Author: MeiChia Chiu <meichia.chiu@mediatek.com>
Date:   Thu Aug 31 14:22:14 2023 +0800

    wifi: mt76: update beacon size limitation
    
    To accommodate 11v MBSSID IE and support maximum 16 MBSSIDs, expand the
    beacon size limitation for beacon and inband discovery commands.
    
    Co-developed-by: Peter Chiu <chui-hao.chiu@mediatek.com>
    Signed-off-by: Peter Chiu <chui-hao.chiu@mediatek.com>
    Co-developed-by: Money Wang <money.wang@mediatek.com>
    Signed-off-by: Money Wang <money.wang@mediatek.com>
    Signed-off-by: MeiChia Chiu <meichia.chiu@mediatek.com>
    Signed-off-by: Shayne Chen <shayne.chen@mediatek.com>
    Signed-off-by: Felix Fietkau <nbd@nbd.name>

commit e35f43aa34d36e6cb1de00705c08026b023ef5ed
Author: Chank Chen <chank.chen@mediatek.com>
Date:   Thu Aug 31 14:22:13 2023 +0800

    wifi: mt76: connac: add MBSSID support for mt7996
    
    Add bss_info_uni_mbssid tag and implement 802.11v MBSSID support for
    mt7996 chipsets.
    
    Signed-off-by: Chank Chen <chank.chen@mediatek.com>
    Signed-off-by: Shayne Chen <shayne.chen@mediatek.com>
    Signed-off-by: Felix Fietkau <nbd@nbd.name>

commit 03f0e11da7fb26db4f27e6b83a223512db9f7ca5
Author: Dmitry Antipov <dmantipov@yandex.ru>
Date:   Tue Aug 29 12:43:49 2023 +0300

    wifi: mt76: fix clang-specific fortify warnings
    
    When compiling with clang 16.0.6 and CONFIG_FORTIFY_SOURCE=y, I've
    noticed the following (somewhat confusing due to absence of an actual
    source code location):
    
    In file included from drivers/net/wireless/mediatek/mt76/mt792x_core.c:4:
    In file included from ./include/linux/module.h:13:
    In file included from ./include/linux/stat.h:19:
    In file included from ./include/linux/time.h:60:
    In file included from ./include/linux/time32.h:13:
    In file included from ./include/linux/timex.h:67:
    In file included from ./arch/x86/include/asm/timex.h:5:
    In file included from ./arch/x86/include/asm/processor.h:23:
    In file included from ./arch/x86/include/asm/msr.h:11:
    In file included from ./arch/x86/include/asm/cpumask.h:5:
    In file included from ./include/linux/cpumask.h:12:
    In file included from ./include/linux/bitmap.h:11:
    In file included from ./include/linux/string.h:254:
    ./include/linux/fortify-string.h:592:4: warning: call to '__read_overflow2_field'
    declared with 'warning' attribute: detected read beyond size of field (2nd
    parameter); maybe use struct_group()? [-Wattribute-warning]
                            __read_overflow2_field(q_size_field, size);
    
    In file included from drivers/net/wireless/mediatek/mt76/mt7915/main.c:4:
    In file included from ./include/linux/etherdevice.h:20:
    In file included from ./include/linux/if_ether.h:19:
    In file included from ./include/linux/skbuff.h:15:
    In file included from ./include/linux/time.h:60:
    In file included from ./include/linux/time32.h:13:
    In file included from ./include/linux/timex.h:67:
    In file included from ./arch/x86/include/asm/timex.h:5:
    In file included from ./arch/x86/include/asm/processor.h:23:
    In file included from ./arch/x86/include/asm/msr.h:11:
    In file included from ./arch/x86/include/asm/cpumask.h:5:
    In file included from ./include/linux/cpumask.h:12:
    In file included from ./include/linux/bitmap.h:11:
    In file included from ./include/linux/string.h:254:
    ./include/linux/fortify-string.h:592:4: warning: call to '__read_overflow2_field'
    declared with 'warning' attribute: detected read beyond size of field (2nd
    parameter); maybe use struct_group()? [-Wattribute-warning]
                            __read_overflow2_field(q_size_field, size);
    
    In file included from drivers/net/wireless/mediatek/mt76/mt7996/main.c:6:
    In file included from drivers/net/wireless/mediatek/mt76/mt7996/mt7996.h:9:
    In file included from ./include/linux/interrupt.h:8:
    In file included from ./include/linux/cpumask.h:12:
    In file included from ./include/linux/bitmap.h:11:
    In file included from ./include/linux/string.h:254:
    ./include/linux/fortify-string.h:592:4: warning: call to '__read_overflow2_field'
    declared with 'warning' attribute: detected read beyond size of field (2nd
    parameter); maybe use struct_group()? [-Wattribute-warning]
                            __read_overflow2_field(q_size_field, size);
    
    The compiler actually complains on 'mt7915_get_et_strings()',
    'mt792x_get_et_strings()' and 'mt7996_get_et_strings()' due to the same
    reason: fortification logic inteprets call to 'memcpy()' as an attempt
    to copy the whole array from its first member and so issues an overread
    warning. These warnings may be silenced by passing an address of the whole
    array and not the first member to 'memcpy()'.
    
    Signed-off-by: Dmitry Antipov <dmantipov@yandex.ru>
    Signed-off-by: Felix Fietkau <nbd@nbd.name>

commit fce9c967820a72f600abbf061d7077861685a14d
Author: Ingo Rohloff <lundril@gmx.de>
Date:   Sat Aug 26 22:02:41 2023 +0200

    wifi: mt76: mt7921e: Support MT7992 IP in Xiaomi Redmibook 15 Pro (2023)
    
    In the Xiaomi Redmibook 15 Pro (2023) laptop I have got, a wifi chip is
    used, which according to its PCI Vendor ID is from "ITTIM Technology".
    
    This chip works flawlessly with the mt7921e module.  The driver doesn't
    bind to this PCI device, because the Vendor ID from "ITTIM Technology" is
    not recognized.
    
    This patch adds the PCI Vendor ID from "ITTIM Technology" to the list of
    PCI Vendor IDs and lets the mt7921e driver bind to the mentioned wifi
    chip.
    
    Signed-off-by: Ingo Rohloff <lundril@gmx.de>
    Signed-off-by: Felix Fietkau <nbd@nbd.name>

commit ed160b600ffc1a23fe04c6e8c1b0210f70c45d39
Author: Jinjie Ruan <ruanjinjie@huawei.com>
Date:   Tue Aug 22 14:30:36 2023 +0800

    wifi: mt76: Use PTR_ERR_OR_ZERO() to simplify code
    
    Return PTR_ERR_OR_ZERO() instead of return 0 or PTR_ERR() to
    simplify code.
    
    Signed-off-by: Jinjie Ruan <ruanjinjie@huawei.com>
    Signed-off-by: Felix Fietkau <nbd@nbd.name>

commit ebe81e6b8659bbae5d76c0b292e38abe4aa0cb1d
Author: Deren Wu <deren.wu@mediatek.com>
Date:   Tue Aug 1 22:30:32 2023 +0800

    wifi: mt76: connac: add more unified event IDs
    
    Add more unified event IDs which will be used in new chipset.
    
    This is the preliminary patch for mt7925 support.
    
    Co-developed-by: Lorenzo Bianconi <lorenzo@kernel.org>
    Signed-off-by: Lorenzo Bianconi <lorenzo@kernel.org>
    Signed-off-by: Deren Wu <deren.wu@mediatek.com>
    Signed-off-by: Felix Fietkau <nbd@nbd.name>

commit 3c1199134874d567afe5771721af28a804d78977
Author: Deren Wu <deren.wu@mediatek.com>
Date:   Tue Aug 1 22:30:31 2023 +0800

    wifi: mt76: connac: add more unified command IDs
    
    Add more unified command IDs which will be used in new chipset.
    
    This is the preliminary patch for mt7925 support.
    
    Co-developed-by: Lorenzo Bianconi <lorenzo@kernel.org>
    Signed-off-by: Lorenzo Bianconi <lorenzo@kernel.org>
    Signed-off-by: Deren Wu <deren.wu@mediatek.com>
    Signed-off-by: Felix Fietkau <nbd@nbd.name>

commit 473f26fb167e2cb93a4e75a3cec6c6fe173505c9
Author: Deren Wu <deren.wu@mediatek.com>
Date:   Tue Aug 1 22:30:30 2023 +0800

    wifi: mt76: connac: add data field in struct tlv
    
    Add tlv->data element for tlv parsing easier.
    
    This is a preliminary patch to support mt7925 driver.
    
    Co-developed-by: Lorenzo Bianconi <lorenzo@kernel.org>
    Signed-off-by: Lorenzo Bianconi <lorenzo@kernel.org>
    Signed-off-by: Deren Wu <deren.wu@mediatek.com>
    Signed-off-by: Felix Fietkau <nbd@nbd.name>

commit 975cd4d6d547936aaae6fae0cb4bdc9a18ecc2f8
Author: Deren Wu <deren.wu@mediatek.com>
Date:   Tue Aug 1 22:30:29 2023 +0800

    wifi: mt76: connac: add eht support for tx power
    
    Add eht field in struct mt76_power_limits for 802.11be power config.
    The function stack size would be too big by eht adding in structure,
    we also refactor mt76_connac_mcu_rate_txpower_band() to take dynamic
    allocated memory instead.
    
    This is a preliminary patch to support mt7925 driver.
    
    Co-developed-by: Lorenzo Bianconi <lorenzo@kernel.org>
    Signed-off-by: Lorenzo Bianconi <lorenzo@kernel.org>
    Signed-off-by: Deren Wu <deren.wu@mediatek.com>
    Signed-off-by: Felix Fietkau <nbd@nbd.name>

commit e9eac4eb1bbdeac5b05de085062591dfe1460396
Author: Deren Wu <deren.wu@mediatek.com>
Date:   Tue Aug 1 22:30:28 2023 +0800

    wifi: mt76: connac: add eht support for phy mode config
    
    Add eht configuration support in existing function
    mt76_connac_get_phy_mode_v2() and export it for mt7925.
    
    This is a preliminary patch to support mt7925 driver.
    
    Co-developed-by: Lorenzo Bianconi <lorenzo@kernel.org>
    Signed-off-by: Lorenzo Bianconi <lorenzo@kernel.org>
    Signed-off-by: Deren Wu <deren.wu@mediatek.com>
    Signed-off-by: Felix Fietkau <nbd@nbd.name>

commit d3d7f57e5c1c6e0337a72944f242ed2c8b028861
Author: Deren Wu <deren.wu@mediatek.com>
Date:   Tue Aug 1 22:30:27 2023 +0800

    wifi: mt76: connac: export functions for mt7925
    
    mt7925 rely on the similar functionalities in connac layer.
    Export them for mt7925 reuse.
    
    This is a preliminary patch to support mt7925 driver.
    
    Co-developed-by: Lorenzo Bianconi <lorenzo@kernel.org>
    Signed-off-by: Lorenzo Bianconi <lorenzo@kernel.org>
    Signed-off-by: Deren Wu <deren.wu@mediatek.com>
    Signed-off-by: Felix Fietkau <nbd@nbd.name>

commit 525209262f9c2999f6f5fa0c40b4519cd6acfa2e
Author: Deren Wu <deren.wu@mediatek.com>
Date:   Tue Aug 1 22:30:25 2023 +0800

    wifi: mt76: connac: introduce helper for mt7925 chipset
    
    Introduce is_mt7925() helper for new chipset. mt7925 runs the same
    firmware download and mmio map flow as mt7921.
    
    This is a preliminary patch to support mt7925 driver.
    
    Co-developed-by: Lorenzo Bianconi <lorenzo@kernel.org>
    Signed-off-by: Lorenzo Bianconi <lorenzo@kernel.org>
    Signed-off-by: Deren Wu <deren.wu@mediatek.com>
    Signed-off-by: Felix Fietkau <nbd@nbd.name>

commit b2491018587a4aca6ea398bbad8f142306b8e086
Author: Felix Fietkau <nbd@nbd.name>
Date:   Thu Aug 31 15:13:01 2023 +0200

    wifi: mt76: mt7915: fix monitor mode issues
    
    Enable receiving other-unicast packets
    Disable RX header translation in order to proprerly receive data packets.
    Fixes warnings and missed packets when rx decap offload is enabled
    
    Signed-off-by: Felix Fietkau <nbd@nbd.name>

commit 5d0e7dde4a688948e701939bc7d3fe9adf8786c5
Author: Dmitry Antipov <dmantipov@yandex.ru>
Date:   Fri Sep 1 11:19:04 2023 +0300

    wifi: mt76: add DMA mapping error check in mt76_alloc_txwi()
    
    Add 'dma_mapping_error()' check in 'mt76_alloc_txwi()'.
    
    Signed-off-by: Dmitry Antipov <dmantipov@yandex.ru>
    Signed-off-by: Felix Fietkau <nbd@nbd.name>

commit 832f42699791e7a90e81c15da0ce886b4f8300b8
Author: Felix Fietkau <nbd@nbd.name>
Date:   Mon Sep 11 15:15:18 2023 +0200

    wifi: mt76: remove unused error path in mt76_connac_tx_complete_skb
    
    The error handling code was added in order to allow tx enqueue to fail after
    calling .tx_prepare_skb. Since this can no longer happen, the error handling
    code is unused.
    
    Signed-off-by: Felix Fietkau <nbd@nbd.name>

commit 0335c034e7265d36d956e806f33202c94a8a9860
Author: Felix Fietkau <nbd@nbd.name>
Date:   Tue Aug 29 10:39:53 2023 +0200

    wifi: mt76: fix race condition related to checking tx queue fill status
    
    When drv_tx calls race against local tx scheduling, the queue fill status checks
    can potentially race, leading to dma queue entries being overwritten.
    Fix this by deferring packets from drv_tx calls to the tx worker, in order to
    ensure that all regular queue tx comes from the same context.
    
    Reported-by: Ryder Lee <Ryder.Lee@mediatek.com>
    Signed-off-by: Felix Fietkau <nbd@nbd.name>

commit debd133ab2e2e06989c24e1a72be2b7997f30456
Author: Johannes Berg <johannes.berg@intel.com>
Date:   Mon Aug 28 17:18:31 2023 +0200

    wifi: mt76: use atomic iface iteration for pre-TBTT work
    
    In addition to the previous series I posted, over time I'd
    also like to get rid of the iflist_mtx in mac80211. That
    isn't easy now since lots of places use iteration and would
    have to be audited, but even a cursory look suggests that
    mt76 might be more problematic than most since holding the
    wiphy lock for the latency-sensitive pre-TBTT work could be
    an issue.
    
    Convert the pre-TBTT work to use atomic iteration and then
    sending the device commands outside of it.
    
    Signed-off-by: Johannes Berg <johannes.berg@intel.com>
    Signed-off-by: Felix Fietkau <nbd@nbd.name>

commit c2fcc83b41a64ae3baa12dfb7ee5d8587373493d
Author: Felix Fietkau <nbd@nbd.name>
Date:   Mon Aug 14 14:10:51 2023 +0200

    wifi: mt76: mt7603: disable A-MSDU tx support on MT7628
    
    It was reported that this can cause the PSE hang issues, even with a low
    number of fragments.
    
    Link: https://github.com/openwrt/mt76/issues/793#issuecomment-1676529138
    Signed-off-by: Felix Fietkau <nbd@nbd.name>

commit 19e4f271d62e14e92d15bebddc567dab2eb47535
Author: Felix Fietkau <nbd@nbd.name>
Date:   Fri Jul 28 16:23:47 2023 +0200

    wifi: mt76: mt7603: add missing register initialization for MT7628
    
    Ported from the vendor driver code
    
    Signed-off-by: Felix Fietkau <nbd@nbd.name>

commit 3176205933494bd184c6acd70e796c382bc729b5
Author: Felix Fietkau <nbd@nbd.name>
Date:   Fri Jul 28 16:21:18 2023 +0200

    wifi: mt76: mt7603: improve stuck beacon handling
    
    Before preparing the new beacon, check the queue status, flush out all
    previous beacons and buffered multicast packets, then (if necessary)
    try to recover more gracefully from a stuck beacon condition by making a
    less invasive attempt at getting the MAC un-stuck.
    
    Fixes: c8846e101502 ("mt76: add driver for MT7603E and MT7628/7688")
    Signed-off-by: Felix Fietkau <nbd@nbd.name>

commit c677dda165231c3efffb9de4bace249d5d2a51b9
Author: Felix Fietkau <nbd@nbd.name>
Date:   Fri Jul 28 16:04:40 2023 +0200

    wifi: mt76: mt7603: improve watchdog reset reliablity
    
    Only trigger PSE reset if PSE was stuck, otherwise it can cause DMA issues.
    Trigger the PSE reset while DMA is fully stopped in order to improve
    reliabilty.
    
    Fixes: c8846e101502 ("mt76: add driver for MT7603E and MT7628/7688")
    Signed-off-by: Felix Fietkau <nbd@nbd.name>

commit baa19b2e4b7bbb509a7ca7939c8785477dcd40ee
Author: Felix Fietkau <nbd@nbd.name>
Date:   Fri Jul 28 09:51:01 2023 +0200

    wifi: mt76: mt7603: rework/fix rx pse hang check
    
    It turns out that the code in mt7603_rx_pse_busy() does not detect actual
    hardware hangs, it only checks for busy conditions in PSE.
    A reset should only be performed if these conditions are true and if there
    is no rx activity as well.
    Reset the counter whenever a rx interrupt occurs. In order to also deal with
    a fully loaded CPU that leaves interrupts disabled with continuous NAPI
    polling, also check for pending rx interrupts in the function itself.
    
    Fixes: c8846e101502 ("mt76: add driver for MT7603E and MT7628/7688")
    Signed-off-by: Felix Fietkau <nbd@nbd.name>

commit 684e45e120b82deccaf8b85633905304a3bbf56d
Author: Felix Fietkau <nbd@nbd.name>
Date:   Tue Sep 19 21:47:47 2023 +0200

    wifi: mt76: mt76x02: fix MT76x0 external LNA gain handling
    
    On MT76x0, LNA gain should be applied for both external and internal LNA.
    On MT76x2, LNA gain should be treated as 0 for external LNA.
    Move the LNA type based logic to mt76x2 in order to fix mt76x0.
    
    Fixes: 2daa67588f34 ("mt76x0: unify lna_gain parsing")
    Reported-by: Shiji Yang <yangshiji66@outlook.com>
    Signed-off-by: Felix Fietkau <nbd@nbd.name>
    Signed-off-by: Kalle Valo <kvalo@kernel.org>
    Link: https://lore.kernel.org/r/20230919194747.31647-1-nbd@nbd.name

commit bafd764a8baa87e19e6beeaa58eb85fcbbdd6b20
Author: Lorenzo Bianconi <lorenzo@kernel.org>
Date:   Mon Sep 18 12:29:07 2023 +0200

    net: ethernet: mtk_wed: rename mtk_rxbm_desc in mtk_wed_bm_desc
    
    Rename mtk_rxbm_desc structure in mtk_wed_bm_desc since it will be used
    even on tx side by MT7988 SoC.
    
    Signed-off-by: Lorenzo Bianconi <lorenzo@kernel.org>
    Signed-off-by: Paolo Abeni <pabeni@redhat.com>

commit e8c1841278a78362f7034f3de415096ddb19f097
Author: Johannes Berg <johannes.berg@intel.com>
Date:   Mon Aug 28 09:54:39 2023 +0200

    wifi: cfg80211: annotate iftype_data pointer with sparse
    
    There were are a number of cases in mac80211 and iwlwifi (at
    least) that used the sband->iftype_data pointer directly,
    instead of using the accessors to find the right array entry
    to use.
    
    Make sparse warn when such a thing is done.
    
    To not have a lot of casts, add two helper functions/macros
    
     - ieee80211_set_sband_iftype_data()
     - for_each_sband_iftype_data()
    
    Signed-off-by: Johannes Berg <johannes.berg@intel.com>

commit 195273147e520844c1aae9fbf85cb6eb0bc0fdd7
Author: Lorenzo Bianconi <lorenzo@kernel.org>
Date:   Mon Aug 28 15:16:11 2023 +0200

    wifi: mt76: fix lock dependency problem for wed_lock
    
    Fix the following kernel depency lock holding wed_lock with BH disabled.
    
    [   40.579696] mt798x-wmac 18000000.wifi: attaching wed device 0 version 2
    [   40.604648] platform 15010000.wed: MTK WED WO Firmware Version: DEV_000000, Build Time: 20221208202138
    [   40.613972] platform 15010000.wed: MTK WED WO Chip ID 00 Region 3
    [   40.943617]
    [   40.945118] ========================================================
    [   40.951457] WARNING: possible irq lock inversion dependency detected
    [   40.957797] 5.15.127 #0 Not tainted
    [   40.961276] --------------------------------------------------------
    [   40.967614] insmod/2329 just changed the state of lock:
    [   40.972827] ffffff8004003b08 (&dev->wed_lock){+.+.}-{2:2}, at: mt76_get_rxwi+0x1c/0xac [mt76]
    [   40.981387] but this lock was taken by another, SOFTIRQ-safe lock in the past:
    [   40.988592]  (&q->lock){+.-.}-{2:2}
    [   40.988602]
    [   40.988602]
    [   40.988602] and interrupts could create inverse lock ordering between them.
    [   40.988602]
    [   41.003445]
    [   41.003445] other info that might help us debug this:
    [   41.009957]  Possible interrupt unsafe locking scenario:
    [   41.009957]
    [   41.016729]        CPU0                    CPU1
    [   41.021245]        ----                    ----
    [   41.025761]   lock(&dev->wed_lock);
    [   41.029241]                                local_irq_disable();
    [   41.035145]                                lock(&q->lock);
    [   41.040620]                                lock(&dev->wed_lock);
    [   41.046616]   <Interrupt>
    [   41.049223]     lock(&q->lock);
    [   41.052356]
    [   41.052356]  *** DEADLOCK ***
    [   41.052356]
    [   41.058260] 1 lock held by insmod/2329:
    [   41.062085]  #0: ffffff80003b9988 (&dev->mutex){....}-{3:3}, at: __driver_attach+0x88/0x190
    [   41.070442]
    [   41.070442] the shortest dependencies between 2nd lock and 1st lock:
    [   41.078257]  -> (&q->lock){+.-.}-{2:2} {
    [   41.082177]     HARDIRQ-ON-W at:
    [   41.085396]                       lock_acquire+0xfc/0x2c0
    [   41.090787]                       _raw_spin_lock_bh+0x84/0xa0
    [   41.096525]                       mt76_dma_cleanup+0x24c/0x650 [mt76]
    [   41.102977]                       mt76_dma_cleanup+0x614/0x650 [mt76]
    [   41.109428]                       mt7915_eeprom_get_power_delta+0x1168/0x2464 [mt7915e]
    [   41.117435]                       mt7915_eeprom_init+0x40/0x340 [mt7915e]
    [   41.124222]                       cleanup_module+0x94/0xb28 [mt7915e]
    [   41.130662]                       platform_probe+0x64/0xbc
    [   41.136139]                       really_probe.part.0+0x98/0x2f4
    [   41.142134]                       __driver_probe_device+0x94/0x16c
    [   41.148303]                       driver_probe_device+0x40/0x120
    [   41.154299]                       __driver_attach+0x94/0x190
    [   41.159947]                       bus_for_each_dev+0x5c/0x94
    [   41.165594]                       driver_attach+0x20/0x30
    [   41.170983]                       bus_add_driver+0x104/0x1f4
    [   41.176631]                       driver_register+0x74/0x120
    [   41.182280]                       __platform_driver_register+0x24/0x30
    [   41.188797]                       0xffffffc000cb1074
    [   41.193754]                       do_one_initcall+0x70/0x2cc
    [   41.199403]                       do_init_module+0x44/0x240
    [   41.204968]                       load_module+0x1f5c/0x2874
    [   41.210532]                       __do_sys_init_module+0x1d8/0x2ac
    [   41.216702]                       __arm64_sys_init_module+0x18/0x20
    [   41.222958]                       invoke_syscall.constprop.0+0x4c/0xe0
    [   41.229474]                       do_el0_svc+0x50/0xf0
    [   41.234602]                       el0_svc+0x4c/0xcc
    [   41.239471]                       el0t_64_sync_handler+0xe0/0x110
    [   41.245556]                       el0t_64_sync+0x15c/0x160
    [   41.251029]     IN-SOFTIRQ-W at:
    [   41.254249]                       lock_acquire+0xfc/0x2c0
    [   41.259638]                       _raw_spin_lock_bh+0x84/0xa0
    [   41.265372]                       mt76_queue_tx_complete+0x34/0x70 [mt76]
    [   41.272170]                       mt76_free_pending_rxwi+0x36c/0x5d0 [mt76]
    [   41.279140]                       mt76_free_pending_rxwi+0x5c0/0x5d0 [mt76]
    [   41.286111]                       mt7915_eeprom_get_power_delta+0x620/0x2464 [mt7915e]
    [   41.294026]                       __napi_poll.constprop.0+0x5c/0x230
    [   41.300372]                       net_rx_action+0xe4/0x294
    [   41.305847]                       _stext+0x154/0x4cc
    [   41.310801]                       do_softirq+0xa4/0xbc
    [   41.315930]                       __local_bh_enable_ip+0x168/0x174
    [   41.322097]                       napi_threaded_poll+0xbc/0x140
    [   41.328007]                       kthread+0x13c/0x150
    [   41.333049]                       ret_from_fork+0x10/0x20
    [   41.338437]     INITIAL USE at:
    [   41.341568]                      lock_acquire+0xfc/0x2c0
    [   41.346869]                      _raw_spin_lock_bh+0x84/0xa0
    [   41.352519]                      mt76_dma_cleanup+0x24c/0x650 [mt76]
    [   41.358882]                      mt76_dma_cleanup+0x614/0x650 [mt76]
    [   41.365245]                      mt7915_eeprom_get_power_delta+0x1168/0x2464 [mt7915e]
    [   41.373160]                      mt7915_eeprom_init+0x40/0x340 [mt7915e]
    [   41.379860]                      cleanup_module+0x94/0xb28 [mt7915e]
    [   41.386213]                      platform_probe+0x64/0xbc
    [   41.391602]                      really_probe.part.0+0x98/0x2f4
    [   41.397511]                      __driver_probe_device+0x94/0x16c
    [   41.403594]                      driver_probe_device+0x40/0x120
    [   41.409502]                      __driver_attach+0x94/0x190
    [   41.415063]                      bus_for_each_dev+0x5c/0x94
    [   41.420625]                      driver_attach+0x20/0x30
    [   41.425926]                      bus_add_driver+0x104/0x1f4
    [   41.431487]                      driver_register+0x74/0x120
    [   41.437049]                      __platform_driver_register+0x24/0x30
    [   41.443479]                      0xffffffc000cb1074
    [   41.448346]                      do_one_initcall+0x70/0x2cc
    [   41.453907]                      do_init_module+0x44/0x240
    [   41.459383]                      load_module+0x1f5c/0x2874
    [   41.464860]                      __do_sys_init_module+0x1d8/0x2ac
    [   41.470944]                      __arm64_sys_init_module+0x18/0x20
    [   41.477113]                      invoke_syscall.constprop.0+0x4c/0xe0
    [   41.483542]                      do_el0_svc+0x50/0xf0
    [   41.488582]                      el0_svc+0x4c/0xcc
    [   41.493364]                      el0t_64_sync_handler+0xe0/0x110
    [   41.499361]                      el0t_64_sync+0x15c/0x160
    [   41.504748]   }
    [   41.506489]   ... key      at: [<ffffffc000c65ba0>] __this_module+0x3e0/0xffffffffffffa840 [mt76]
    [   41.515371]   ... acquired at:
    [   41.518413]    _raw_spin_lock+0x60/0x74
    [   41.522240]    mt76_get_rxwi+0x1c/0xac [mt76]
    [   41.526608]    mt76_dma_cleanup+0x3e0/0x650 [mt76]
    [   41.531410]    mt76_dma_cleanup+0x614/0x650 [mt76]
    [   41.536211]    mt7915_dma_init+0x408/0x7b0 [mt7915e]
    [   41.541177]    mt7915_register_device+0x310/0x620 [mt7915e]
    [   41.546749]    mt7915_mmio_probe+0xcec/0x1d44 [mt7915e]
    [   41.551973]    platform_probe+0x64/0xbc
    [   41.555802]    really_probe.part.0+0x98/0x2f4
    [   41.560149]    __driver_probe_device+0x94/0x16c
    [   41.564670]    driver_probe_device+0x40/0x120
    [   41.569017]    __driver_attach+0x94/0x190
    [   41.573019]    bus_for_each_dev+0x5c/0x94
    [   41.577018]    driver_attach+0x20/0x30
    [   41.580758]    bus_add_driver+0x104/0x1f4
    [   41.584758]    driver_register+0x74/0x120
    [   41.588759]    __platform_driver_register+0x24/0x30
    [   41.593628]    init_module+0x74/0x1000 [mt7915e]
    [   41.598248]    do_one_initcall+0x70/0x2cc
    [   41.602248]    do_init_module+0x44/0x240
    [   41.606162]    load_module+0x1f5c/0x2874
    [   41.610078]    __do_sys_init_module+0x1d8/0x2ac
    [   41.614600]    __arm64_sys_init_module+0x18/0x20
    [   41.619209]    invoke_syscall.constprop.0+0x4c/0xe0
    [   41.624076]    do_el0_svc+0x50/0xf0
    [   41.627555]    el0_svc+0x4c/0xcc
    [   41.630776]    el0t_64_sync_handler+0xe0/0x110
    [   41.635211]    el0t_64_sync+0x15c/0x160
    [   41.639037]
    [   41.640517] -> (&dev->wed_lock){+.+.}-{2:2} {
    [   41.644872]    HARDIRQ-ON-W at:
    [   41.648003]                     lock_acquire+0xfc/0x2c0
    [   41.653219]                     _raw_spin_lock+0x60/0x74
    [   41.658520]                     mt76_free_pending_rxwi+0xc0/0x5d0 [mt76]
    [   41.665232]                     mt76_dma_cleanup+0x1dc/0x650 [mt76]
    [   41.671508]                     mt7915_eeprom_get_power_delta+0x1830/0x2464 [mt7915e]
    [   41.679336]                     mt7915_unregister_device+0x5b4/0x910 [mt7915e]
    [   41.686555]                     mt7915_eeprom_get_target_power+0xb8/0x230 [mt7915e]
    [   41.694209]                     mt7986_wmac_enable+0xc30/0xcd0 [mt7915e]
    [   41.700909]                     platform_remove+0x4c/0x64
    [   41.706298]                     __device_release_driver+0x194/0x240
    [   41.712554]                     driver_detach+0xc0/0x100
    [   41.717857]                     bus_remove_driver+0x54/0xac
    [   41.723418]                     driver_unregister+0x2c/0x54
    [   41.728980]                     platform_driver_unregister+0x10/0x20
    [   41.735323]                     mt7915_ops+0x244/0xffffffffffffed58 [mt7915e]
    [   41.742457]                     __arm64_sys_delete_module+0x170/0x23c
    [   41.748887]                     invoke_syscall.constprop.0+0x4c/0xe0
    [   41.755229]                     do_el0_svc+0x50/0xf0
    [   41.760183]                     el0_svc+0x4c/0xcc
    [   41.764878]                     el0t_64_sync_handler+0xe0/0x110
    [   41.770788]                     el0t_64_sync+0x15c/0x160
    [   41.776088]    SOFTIRQ-ON-W at:
    [   41.779220]                     lock_acquire+0xfc/0x2c0
    [   41.784435]                     _raw_spin_lock+0x60/0x74
    [   41.789737]                     mt76_get_rxwi+0x1c/0xac [mt76]
    [   41.795580]                     mt7915_debugfs_rx_log+0x804/0xb74 [mt7915e]
    [   41.802540]                     mtk_wed_start+0x970/0xaa0
    [   41.807929]                     mt7915_dma_start+0x26c/0x630 [mt7915e]
    [   41.814455]                     mt7915_dma_start+0x5a4/0x630 [mt7915e]
    [   41.820981]                     mt7915_dma_init+0x45c/0x7b0 [mt7915e]
    [   41.827420]                     mt7915_register_device+0x310/0x620 [mt7915e]
    [   41.834467]                     mt7915_mmio_probe+0xcec/0x1d44 [mt7915e]
    [   41.841167]                     platform_probe+0x64/0xbc
    [   41.846469]                     really_probe.part.0+0x98/0x2f4
    [   41.852291]                     __driver_probe_device+0x94/0x16c
    [   41.858286]                     driver_probe_device+0x40/0x120
    [   41.864107]                     __driver_attach+0x94/0x190
    [   41.869582]                     bus_for_each_dev+0x5c/0x94
    [   41.875056]                     driver_attach+0x20/0x30
    [   41.880270]                     bus_add_driver+0x104/0x1f4
    [   41.885745]                     driver_register+0x74/0x120
    [   41.891221]                     __platform_driver_register+0x24/0x30
    [   41.897564]                     init_module+0x74/0x1000 [mt7915e]
    [   41.903657]                     do_one_initcall+0x70/0x2cc
    [   41.909130]                     do_init_module+0x44/0x240
    [   41.914520]                     load_module+0x1f5c/0x2874
    [   41.919909]                     __do_sys_init_module+0x1d8/0x2ac
    [   41.925905]                     __arm64_sys_init_module+0x18/0x20
    [   41.931989]                     invoke_syscall.constprop.0+0x4c/0xe0
    [   41.938331]                     do_el0_svc+0x50/0xf0
    [   41.943285]                     el0_svc+0x4c/0xcc
    [   41.947981]                     el0t_64_sync_handler+0xe0/0x110
    [   41.953892]                     el0t_64_sync+0x15c/0x160
    [   41.959192]    INITIAL USE at:
    [   41.962238]                    lock_acquire+0xfc/0x2c0
    [   41.967365]                    _raw_spin_lock+0x60/0x74
    [   41.972580]                    mt76_free_pending_rxwi+0xc0/0x5d0 [mt76]
    [   41.979206]                    mt76_dma_cleanup+0x1dc/0x650 [mt76]
    [   41.985395]                    mt7915_eeprom_get_power_delta+0x1830/0x2464 [mt7915e]
    [   41.993137]                    mt7915_unregister_device+0x5b4/0x910 [mt7915e]
    [   42.000270]                    mt7915_eeprom_get_target_power+0xb8/0x230 [mt7915e]
    [   42.007837]                    mt7986_wmac_enable+0xc30/0xcd0 [mt7915e]
    [   42.014450]                    platform_remove+0x4c/0x64
    [   42.019753]                    __device_release_driver+0x194/0x240
    [   42.025922]                    driver_detach+0xc0/0x100
    [   42.031137]                    bus_remove_driver+0x54/0xac
    [   42.036612]                    driver_unregister+0x2c/0x54
    [   42.042087]                    platform_driver_unregister+0x10/0x20
    [   42.048344]                    mt7915_ops+0x244/0xffffffffffffed58 [mt7915e]
    [   42.055391]                    __arm64_sys_delete_module+0x170/0x23c
    [   42.061735]                    invoke_syscall.constprop.0+0x4c/0xe0
    [   42.067990]                    do_el0_svc+0x50/0xf0
    [   42.072857]                    el0_svc+0x4c/0xcc
    [   42.077466]                    el0t_64_sync_handler+0xe0/0x110
    [   42.083289]                    el0t_64_sync+0x15c/0x160
    [   42.088503]  }
    [   42.090157]  ... key      at: [<ffffffc000c65c10>] __this_module+0x450/0xffffffffffffa840 [mt76]
    [   42.098951]  ... acquired at:
    [   42.101907]    __lock_acquire+0x718/0x1df0
    [   42.105994]    lock_acquire+0xfc/0x2c0
    [   42.109734]    _raw_spin_lock+0x60/0x74
    [   42.113561]    mt76_get_rxwi+0x1c/0xac [mt76]
    [   42.117929]    mt7915_debugfs_rx_log+0x804/0xb74 [mt7915e]
    [   42.123415]    mtk_wed_start+0x970/0xaa0
    [   42.127328]    mt7915_dma_start+0x26c/0x630 [mt7915e]
    [   42.132379]    mt7915_dma_start+0x5a4/0x630 [mt7915e]
    [   42.137430]    mt7915_dma_init+0x45c/0x7b0 [mt7915e]
    [   42.142395]    mt7915_register_device+0x310/0x620 [mt7915e]
    [   42.147967]    mt7915_mmio_probe+0xcec/0x1d44 [mt7915e]
    [   42.153192]    platform_probe+0x64/0xbc
    [   42.157019]    really_probe.part.0+0x98/0x2f4
    [   42.161367]    __driver_probe_device+0x94/0x16c
    [   42.165887]    driver_probe_device+0x40/0x120
    [   42.170234]    __driver_attach+0x94/0x190
    [   42.174235]    bus_for_each_dev+0x5c/0x94
    [   42.178235]    driver_attach+0x20/0x30
    [   42.181974]    bus_add_driver+0x104/0x1f4
    [   42.185974]    driver_register+0x74/0x120
    [   42.189974]    __platform_driver_register+0x24/0x30
    [   42.194842]    init_module+0x74/0x1000 [mt7915e]
    [   42.199460]    do_one_initcall+0x70/0x2cc
    [   42.203460]    do_init_module+0x44/0x240
    [   42.207376]    load_module+0x1f5c/0x2874
    [   42.211290]    __do_sys_init_module+0x1d8/0x2ac
    [   42.215813]    __arm64_sys_init_module+0x18/0x20
    [   42.220421]    invoke_syscall.constprop.0+0x4c/0xe0
    [   42.225288]    do_el0_svc+0x50/0xf0
    [   42.228768]    el0_svc+0x4c/0xcc
    [   42.231989]    el0t_64_sync_handler+0xe0/0x110
    [   42.236424]    el0t_64_sync+0x15c/0x160
    [   42.240249]
    [   42.241730]
    [   42.241730] stack backtrace:
    [   42.246074] CPU: 1 PID: 2329 Comm: insmod Not tainted 5.15.127 #0
    [   42.252157] Hardware name: GainStrong Oolite-MT7981B V1 Dev Board (NAND boot) (DT)
    [   42.259712] Call trace:
    [   42.262147]  dump_backtrace+0x0/0x174
    [   42.265802]  show_stack+0x14/0x20
    [   42.269108]  dump_stack_lvl+0x84/0xac
    [   42.272761]  dump_stack+0x14/0x2c
    [   42.276066]  print_irq_inversion_bug.part.0+0x1b0/0x1c4
    [   42.281285]  mark_lock+0x8b8/0x8bc
    [   42.284678]  __lock_acquire+0x718/0x1df0
    [   42.288592]  lock_acquire+0xfc/0x2c0
    [   42.292158]  _raw_spin_lock+0x60/0x74
    [   42.295811]  mt76_get_rxwi+0x1c/0xac [mt76]
    [   42.300008]  mt7915_debugfs_rx_log+0x804/0xb74 [mt7915e]
    [   42.305320]  mtk_wed_start+0x970/0xaa0
    [   42.309059]  mt7915_dma_start+0x26c/0x630 [mt7915e]
    [   42.313937]  mt7915_dma_start+0x5a4/0x630 [mt7915e]
    [   42.318815]  mt7915_dma_init+0x45c/0x7b0 [mt7915e]
    [   42.323606]  mt7915_register_device+0x310/0x620 [mt7915e]
    [   42.329005]  mt7915_mmio_probe+0xcec/0x1d44 [mt7915e]
    [   42.334056]  platform_probe+0x64/0xbc
    [   42.337711]  really_probe.part.0+0x98/0x2f4
    [   42.341885]  __driver_probe_device+0x94/0x16c
    [   42.346232]  driver_probe_device+0x40/0x120
    [   42.350407]  __driver_attach+0x94/0x190
    [   42.354234]  bus_for_each_dev+0x5c/0x94
    [   42.358061]  driver_attach+0x20/0x30
    [   42.361627]  bus_add_driver+0x104/0x1f4
    [   42.365454]  driver_register+0x74/0x120
    [   42.369282]  __platform_driver_register+0x24/0x30
    [   42.373977]  init_module+0x74/0x1000 [mt7915e]
    [   42.378423]  do_one_initcall+0x70/0x2cc
    [   42.382249]  do_init_module+0x44/0x240
    [   42.385990]  load_module+0x1f5c/0x2874
    [   42.389733]  __do_sys_init_module+0x1d8/0x2ac
    [   42.394082]  __arm64_sys_init_module+0x18/0x20
    [   42.398518]  invoke_syscall.constprop.0+0x4c/0xe0
    [   42.403211]  do_el0_svc+0x50/0xf0
    [   42.406517]  el0_svc+0x4c/0xcc
    [   42.409565]  el0t_64_sync_handler+0xe0/0x110
    [   42.413827]  el0t_64_sync+0x15c/0x160
    [   42.674858] mt798x-wmac 18000000.wifi: HW/SW Version: 0x8a108a10, Build Time: 20221208201745a
    [   42.674858]
    [   42.692078] mt798x-wmac 18000000.wifi: WM Firmware Version: ____000000, Build Time: 20221208201806
    [   42.735606] mt798x-wmac 18000000.wifi: WA Firmware Version: DEV_000000, Build Time: 20221208202048
    
    Tested-by: Daniel Golle <daniel@makrotopia.org>
    Fixes: 2666bece0905 ("wifi: mt76: introduce rxwi and rx token utility routines")
    Signed-off-by: Lorenzo Bianconi <lorenzo@kernel.org>
    Acked-by: Felix Fietkau <nbd@nbd.name>
    Signed-off-by: Kalle Valo <kvalo@kernel.org>
    Link: https://lore.kernel.org/r/ee80be41c2a8d8749d83c6950a272a5e77aadd45.1693228333.git.lorenzo@kernel.org

commit 5d7cf67f72ae34d38e090bdfa673da4aefe4048e
Author: Alan Stern <stern@rowland.harvard.edu>
Date:   Tue Aug 8 20:44:48 2023 -0400

    Fix nomenclature for USB and PCI wireless devices
    
    A mouse that uses a USB connection is called a "USB mouse" device (or
    "USB mouse" for short), not a "mouse USB" device.  By analogy, a WiFi
    adapter that connects to the host computer via USB is a "USB wireless"
    device, not a "wireless USB" device.  (The latter term more properly
    refers to a defunct Wireless USB specification, which described a
    technology for sending USB protocol messages over an ultra wideband
    radio link.)
    
    Similarly for a WiFi adapter card that plugs into a PCIe slot: It is a
    "PCIe wireless" device, not a "wireless PCIe" device.
    
    Rephrase the text in the kernel source where the word ordering is
    wrong.
    
    Signed-off-by: Alan Stern <stern@rowland.harvard.edu>
    Reviewed-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
    Signed-off-by: Kalle Valo <kvalo@kernel.org>
    Link: https://lore.kernel.org/r/57da7c80-0e48-41b5-8427-884a02648f55@rowland.harvard.edu

commit 1e4c574225cc5a0553115e5eb5787d1474db5b0f
Author: Alan Stern <stern@rowland.harvard.edu>
Date:   Tue Aug 8 20:44:18 2023 -0400

    USB: Remove remnants of Wireless USB and UWB
    
    Wireless USB has long been defunct, and kernel support for it was
    removed in 2020 by commit caa6772db4c1 ("Staging: remove wusbcore and
    UWB from the kernel tree.").
    
    Nevertheless, some vestiges of the old implementation still clutter up
    the USB subsystem and one or two other places.  Let's get rid of them
    once and for all.
    
    The only parts still left are the user-facing APIs in
    include/uapi/linux/usb/ch9.h.  (There are also a couple of misleading
    instances, such as the Sierra Wireless USB modem, which is a USB modem
    made by Sierra Wireless.)
    
    Signed-off-by: Alan Stern <stern@rowland.harvard.edu>
    Link: https://lore.kernel.org/r/b4f2710f-a2de-4fb0-b50f-76776f3a961b@rowland.harvard.edu
    Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>

commit a9ca9f9ceff382b58b488248f0c0da9e157f5d06
Author: Yunsheng Lin <linyunsheng@huawei.com>
Date:   Fri Aug 4 20:05:24 2023 +0200

    page_pool: split types and declarations from page_pool.h
    
    Split types and pure function declarations from page_pool.h
    and add them in page_page/types.h, so that C sources can
    include page_pool.h and headers should generally only include
    page_pool/types.h as suggested by jakub.
    Rename page_pool.h to page_pool/helpers.h to have both in
    one place.
    
    Signed-off-by: Yunsheng Lin <linyunsheng@huawei.com>
    Suggested-by: Jakub Kicinski <kuba@kernel.org>
    Signed-off-by: Alexander Lobakin <aleksander.lobakin@intel.com>
    Reviewed-by: Alexander Duyck <alexanderduyck@fb.com>
    Link: https://lore.kernel.org/r/20230804180529.2483231-2-aleksander.lobakin@intel.com
    [Jakub: change microsoft/mana, fix kdoc paths in Documentation]
    Signed-off-by: Jakub Kicinski <kuba@kernel.org>

commit d6b484b5cb2a7d509b36a220911509ddd8b777c4
Author: Azeem Shaikh <azeemshaikh38@gmail.com>
Date:   Mon Jul 3 18:12:56 2023 +0000

    wifi: mt76: Replace strlcpy() with strscpy()
    
    strlcpy() reads the entire source buffer first.
    This read may exceed the destination size limit.
    This is both inefficient and can lead to linear read
    overflows if a source string is not NUL-terminated [1].
    In an effort to remove strlcpy() completely [2], replace
    strlcpy() here with strscpy().
    
    Direct replacement is safe here since DEV_ASSIGN is only used by
    TRACE macros and the return values are ignored.
    
    [1] https://www.kernel.org/doc/html/latest/process/deprecated.html#strlcpy
    [2] https://github.com/KSPP/linux/issues/89
    
    Signed-off-by: Azeem Shaikh <azeemshaikh38@gmail.com>
    Reviewed-by: Kees Cook <keescook@chromium.org>
    Signed-off-by: Kalle Valo <kvalo@kernel.org>
    Link: https://lore.kernel.org/r/20230703181256.3712079-1-azeemshaikh38@gmail.com

commit e7899a90cebec045ce88505d496d8453174044c2
Author: Rob Herring <robh@kernel.org>
Date:   Mon Jul 24 15:19:13 2023 -0600

    wifi: drivers: Explicitly include correct DT includes
    
    The DT of_device.h and of_platform.h date back to the separate
    of_platform_bus_type before it as merged into the regular platform bus.
    As part of that merge prepping Arm DT support 13 years ago, they
    "temporarily" include each other. They also include platform_device.h
    and of.h. As a result, there's a pretty much random mix of those include
    files used throughout the tree. In order to detangle these headers and
    replace the implicit includes with struct declarations, users need to
    explicitly include the correct includes.
    
    Signed-off-by: Rob Herring <robh@kernel.org>
    Signed-off-by: Kalle Valo <kvalo@kernel.org>
    Link: https://lore.kernel.org/r/20230724211914.805876-1-robh@kernel.org

commit 6c0570bc21ec2073890aa252c8420ca7bec402e4
Author: Ryder Lee <ryder.lee@mediatek.com>
Date:   Thu Jul 27 02:35:06 2023 +0800

    wifi: mt76: mt7915: fix power-limits while chan_switch
    
    If user changes the channel without completely disabling the interface the
    txpower_sku values reported track the old channel the device was operating on.
    If user bounces the interface the correct power tables are applied.
    
    mt7915_sku_group_len array gets updated before the channel switch happens so it
    uses data from the old channel.
    
    Fixes: ecb187a74e18 ("mt76: mt7915: rework the flow of txpower setting")
    Fixes: f1d962369d56 ("mt76: mt7915: implement HE per-rate tx power support")
    Reported-By: Chad Monroe <chad.monroe@smartrg.com>
    Tested-by: Chad Monroe <chad.monroe@smartrg.com>
    Signed-off-by: Allen Ye <allen.ye@mediatek.com>
    Signed-off-by: Ryder Lee <ryder.lee@mediatek.com>
    Signed-off-by: Felix Fietkau <nbd@nbd.name>

commit 4f1875c288dfc1ccea81fc17fef1d30c9d8498b2
Author: Ryder Lee <ryder.lee@mediatek.com>
Date:   Thu Jul 27 02:35:05 2023 +0800

    wifi: mt76: mt7915: fix tlv length of mt7915_mcu_get_chan_mib_info
    
    Correct per-device TLV lengths to avoid invalid operation in firmware.
    (  64.040375:28:STATS-E)statsGetSingleHWCounter: MIB counter index = 65472 not supported.
    This happens on mt7916/mt7986.
    
    Fixes: b0bfa00595be ("wifi: mt76: mt7915: improve accuracy of time_busy calculation")
    Signed-off-by: Ryder Lee <ryder.lee@mediatek.com>
    Signed-off-by: Felix Fietkau <nbd@nbd.name>

commit 3bb014c72b087fa1d440d1b83cb3dfcfc4d24cff
Author: Yuanjun Gong <ruc_gongyuanjun@163.com>
Date:   Mon Jul 17 22:50:08 2023 +0800

    wifi: mt76: mt76x02: fix return value check in mt76x02_mac_process_rx
    
    in mt76x02_mac_process_rx(), return an error code if an
    unexpected result is returned by pskb_trim.
    
    Signed-off-by: Yuanjun Gong <ruc_gongyuanjun@163.com>
    Signed-off-by: Felix Fietkau <nbd@nbd.name>

commit 74f12d511625e603fac8c0c2b6872e687e56dd61
Author: Lin Ma <linma@zju.edu.cn>
Date:   Sun Jul 23 16:03:50 2023 +0800

    wifi: mt76: testmode: add nla_policy for MT76_TM_ATTR_TX_LENGTH
    
    It seems that the nla_policy in mt76_tm_policy is missed for attribute
    MT76_TM_ATTR_TX_LENGTH. This patch adds the correct description to make
    sure the
    
      u32 val = nla_get_u32(tb[MT76_TM_ATTR_TX_LENGTH]);
    
    in function mt76_testmode_cmd() is safe and will not result in
    out-of-attribute read.
    
    Fixes: f0efa8621550 ("mt76: add API for testmode support")
    Signed-off-by: Lin Ma <linma@zju.edu.cn>
    Signed-off-by: Felix Fietkau <nbd@nbd.name>

commit fc80731ba06316da80be2993c91c315c9923dac0
Author: Lorenzo Bianconi <lorenzo@kernel.org>
Date:   Wed Jun 28 15:07:24 2023 +0800

    wifi: mt76: mt7921: move mt7921u_disconnect mt792x-lib
    
    mt7921u_disconnect routine is shared between mt7921 and mt7925 so move
    it in mt792x-usb module.
    
    Signed-off-by: Lorenzo Bianconi <lorenzo@kernel.org>
    Signed-off-by: Deren Wu <deren.wu@mediatek.com>
    Signed-off-by: Felix Fietkau <nbd@nbd.name>

commit 2e7f7a2c871cd3b4a01c0a325f86f5b112f3b50f
Author: Lorenzo Bianconi <lorenzo@kernel.org>
Date:   Wed Jun 28 15:07:23 2023 +0800

    wifi: mt76: mt7921: move mt7921_dma_init in pci.c
    
    Move mt7921_dma_init routine in pci.c and make it static since it is run
    just in mt7921_pci_probe(). Get rid of dma.c.
    
    Signed-off-by: Lorenzo Bianconi <lorenzo@kernel.org>
    Signed-off-by: Deren Wu <deren.wu@mediatek.com>
    Signed-off-by: Felix Fietkau <nbd@nbd.name>

commit 7d403f3a19c6687f51c5e7423e28ddfd00983477
Author: Lorenzo Bianconi <lorenzo@kernel.org>
Date:   Wed Jun 28 15:07:22 2023 +0800

    wifi: mt76: mt792x: move MT7921_PM_TIMEOUT and MT7921_HW_SCAN_TIMEOUT in common code
    
    MT7921_PM_TIMEOUT is shared between mt7925 and mt7921 so move it in
    mt792x module.
    
    Signed-off-by: Lorenzo Bianconi <lorenzo@kernel.org>
    Signed-off-by: Deren Wu <deren.wu@mediatek.com>
    Signed-off-by: Felix Fietkau <nbd@nbd.name>

commit 583204ae70f9f4d1cf8f2874a6c0706e5528eab1
Author: Lorenzo Bianconi <lorenzo@kernel.org>
Date:   Wed Jun 28 15:07:20 2023 +0800

    wifi: mt76: mt792x: move mt7921_load_firmware in mt792x-lib module
    
    mt7921_load_firmware routine is shared between mt7921 and mt7925 chipset
    so move it in mt792x-lib module.
    
    Signed-off-by: Lorenzo Bianconi <lorenzo@kernel.org>
    Signed-off-by: Deren Wu <deren.wu@mediatek.com>
    Signed-off-by: Felix Fietkau <nbd@nbd.name>

commit d28e1a48952e60fe47bba5b79fdbafc65f6c892b
Author: Lorenzo Bianconi <lorenzo@kernel.org>
Date:   Wed Jun 28 15:07:19 2023 +0800

    wifi: mt76: mt792x: introduce mt792x-usb module
    
    Add usb shared code between mt7921 and mt7925 chipset to mt792x-usb module.
    
    Signed-off-by: Lorenzo Bianconi <lorenzo@kernel.org>
    Signed-off-by: Deren Wu <deren.wu@mediatek.com>
    Signed-off-by: Felix Fietkau <nbd@nbd.name>

commit 29f5a494f7a22ab4661dc835c1d208e1a61793e7
Author: Lorenzo Bianconi <lorenzo@kernel.org>
Date:   Wed Jun 28 15:07:18 2023 +0800

    wifi: mt76: mt7921: move acpi_sar code in mt792x-lib module
    
    Move acpi_sar code in mt792x-lib module since it is shared between
    mt7921 and mt7925 driver.
    
    Signed-off-by: Lorenzo Bianconi <lorenzo@kernel.org>
    Signed-off-by: Deren Wu <deren.wu@mediatek.com>
    Signed-off-by: Felix Fietkau <nbd@nbd.name>

commit 1c0254967d94bf5826ae5ea5f84960172db955ff
Author: Lorenzo Bianconi <lorenzo@kernel.org>
Date:   Wed Jun 28 15:07:17 2023 +0800

    wifi: mt76: mt7921: move runtime-pm pci code in mt792x-lib
    
    Move the following runtime-pm pci routines in mt792x-lib since they are
    shared between mt7921 and mt7925 chipsets:
    - __mt7921e_mcu_drv_pmctrl
    - mt7921e_mcu_drv_pmctrl
    - mt7921e_mcu_fw_pmctrl
    
    Signed-off-by: Lorenzo Bianconi <lorenzo@kernel.org>
    Signed-off-by: Deren Wu <deren.wu@mediatek.com>
    Signed-off-by: Felix Fietkau <nbd@nbd.name>

commit c21a7f9f406bba3f7ee8ce788ef48592c8c3ba8f
Author: Lorenzo Bianconi <lorenzo@kernel.org>
Date:   Wed Jun 28 15:07:16 2023 +0800

    wifi: mt76: mt7921: move shared runtime-pm code on mt792x-lib
    
    Moving hif_ops marcos in mt792x.h, we can move shared runtime-pm code
    between mt7925 and mt7921 in mt792x-lib module.
    
    Signed-off-by: Lorenzo Bianconi <lorenzo@kernel.org>
    Signed-off-by: Deren Wu <deren.wu@mediatek.com>
    Signed-off-by: Felix Fietkau <nbd@nbd.name>

commit 5c041325cd0b1307b196c686f87f8531d4d3f105
Author: Lorenzo Bianconi <lorenzo@kernel.org>
Date:   Wed Jun 28 15:07:15 2023 +0800

    wifi: mt76: mt7921: move hif_ops macro in mt792x.h
    
    Move the following hif_ops macro in mt792x.h:
    - mt7925_init_reset
    - mt7925_dev_reset
    - mt7925_mcu_init
    - __mt7925_mcu_drv_pmctrl
    - __mt7925_mcu_fw_pmctrl
    
    Signed-off-by: Lorenzo Bianconi <lorenzo@kernel.org>
    Signed-off-by: Deren Wu <deren.wu@mediatek.com>
    Signed-off-by: Felix Fietkau <nbd@nbd.name>

commit ff6551740000eac6a63445d30d5bac5c0ca900c3
Author: Lorenzo Bianconi <lorenzo@kernel.org>
Date:   Wed Jun 28 15:07:14 2023 +0800

    wifi: mt76: mt792x: move more dma shared code in mt792x_dma
    
    Rely on irq_map support, move more dma shared code between mt7921 and
    mt7925 in mt792x_dma.c
    Move the following dma code in mt792x-lib
    - mt792x_dma_enable
    - mt792x_dma_reset
    - mt792x_wpdma_reset
    - mt792x_wpdma_reinit_cond
    
    Signed-off-by: Lorenzo Bianconi <lorenzo@kernel.org>
    Signed-off-by: Deren Wu <deren.wu@mediatek.com>
    Signed-off-by: Felix Fietkau <nbd@nbd.name>

commit c9072f112fcf7b31c33a0097a3e020fe077f82bf
Author: Lorenzo Bianconi <lorenzo@kernel.org>
Date:   Wed Jun 28 15:06:02 2023 +0800

    wifi: mt76: mt792x: introduce mt792x_irq_map
    
    mt792x_irq_map will be use to share the irq code shared between mt7921
    and mt7925
    
    Signed-off-by: Lorenzo Bianconi <lorenzo@kernel.org>
    Signed-off-by: Deren Wu <deren.wu@mediatek.com>
    Signed-off-by: Felix Fietkau <nbd@nbd.name>

commit e8a264ccd2de0db8ffc2c6ed2c23644ed15854d4
Author: Lorenzo Bianconi <lorenzo@kernel.org>
Date:   Wed Jun 28 15:06:01 2023 +0800

    wifi: mt76: mt7921: move init shared code in mt792x-lib module
    
    Reduce duplicated code moving init shared code in mt792x-lib module.
    
    Signed-off-by: Lorenzo Bianconi <lorenzo@kernel.org>
    Signed-off-by: Deren Wu <deren.wu@mediatek.com>
    Signed-off-by: Felix Fietkau <nbd@nbd.name>

commit 974e759c3fd99813bd2b537acb8bb936c5f2bae7
Author: Lorenzo Bianconi <lorenzo@kernel.org>
Date:   Wed Jun 28 15:06:00 2023 +0800

    wifi: mt76: mt7921: move debugfs shared code in mt792x-lib module
    
    Reduce duplicated code moving debugfs shared code in mt792x-lib module.
    
    Signed-off-by: Lorenzo Bianconi <lorenzo@kernel.org>
    Signed-off-by: Deren Wu <deren.wu@mediatek.com>
    Signed-off-by: Felix Fietkau <nbd@nbd.name>

commit c693f2f068c0b21235994b7722bc635e854857a1
Author: Lorenzo Bianconi <lorenzo@kernel.org>
Date:   Wed Jun 28 15:05:59 2023 +0800

    wifi: mt76: mt7921: move dma shared code in mt792x-lib module
    
    Reduce duplicated code moving dma shared code in mt792x-lib module.
    
    Signed-off-by: Lorenzo Bianconi <lorenzo@kernel.org>
    Signed-off-by: Deren Wu <deren.wu@mediatek.com>
    Signed-off-by: Felix Fietkau <nbd@nbd.name>

commit 311f121c240967ad4add9e4b00fbd5204e9b93f7
Author: Lorenzo Bianconi <lorenzo@kernel.org>
Date:   Wed Jun 28 15:05:58 2023 +0800

    wifi: mt76: mt7921: move mac shared code in mt792x-lib module
    
    Reduce duplicated code moving mac shared code in mt792x-lib module.
    
    Signed-off-by: Lorenzo Bianconi <lorenzo@kernel.org>
    Signed-off-by: Deren Wu <deren.wu@mediatek.com>
    Signed-off-by: Felix Fietkau <nbd@nbd.name>

commit c74df1c067f2af0a3758a5ab02806f501473797c
Author: Lorenzo Bianconi <lorenzo@kernel.org>
Date:   Wed Jun 28 15:05:57 2023 +0800

    wifi: mt76: mt792x: introduce mt792x-lib module
    
    mt792x-lib module will contain the shared code between mt7921 and new
    MT79 WiFi7 chipset
    
    Signed-off-by: Lorenzo Bianconi <lorenzo@kernel.org>
    Signed-off-by: Deren Wu <deren.wu@mediatek.com>
    Signed-off-by: Felix Fietkau <nbd@nbd.name>

commit 20249e1a853c412f452aa6ee0beb752360e69f17
Author: Lorenzo Bianconi <lorenzo@kernel.org>
Date:   Wed Jun 28 15:05:56 2023 +0800

    wifi: mt76: mt7921: move mt792x_hw_dev in mt792x.h
    
    This is a preliminary patch to introduce WiFi7 chipset support
    
    Signed-off-by: Lorenzo Bianconi <lorenzo@kernel.org>
    Signed-off-by: Deren Wu <deren.wu@mediatek.com>
    Signed-off-by: Felix Fietkau <nbd@nbd.name>

commit c605d0ce025358d50209468ede7b15a3d2656c1a
Author: Lorenzo Bianconi <lorenzo@kernel.org>
Date:   Wed Jun 28 15:05:55 2023 +0800

    wifi: mt76: mt7921: move mt792x_mutex_{acquire/release} in mt792x.h
    
    This is a preliminary patch to introduce WiFi7 chipset support
    
    Signed-off-by: Lorenzo Bianconi <lorenzo@kernel.org>
    Signed-off-by: Deren Wu <deren.wu@mediatek.com>
    Signed-off-by: Felix Fietkau <nbd@nbd.name>

commit 1c42e0f283598b43b74318ef54f3d8a57ab46324
Author: Lorenzo Bianconi <lorenzo@kernel.org>
Date:   Wed Jun 28 15:05:54 2023 +0800

    wifi: mt76: mt792x: move shared structure definition in mt792x.h
    
    This is a preliminary patch to introduce WiFi7 chipset support
    
    Signed-off-by: Lorenzo Bianconi <lorenzo@kernel.org>
    Signed-off-by: Deren Wu <deren.wu@mediatek.com>
    Signed-off-by: Felix Fietkau <nbd@nbd.name>

commit 838cc6679733584d6f1c1e8423a1ad5aa5cb9ad0
Author: Lorenzo Bianconi <lorenzo@kernel.org>
Date:   Wed Jun 28 15:05:53 2023 +0800

    wifi: mt76: mt7921: rename mt7921_hif_ops in mt792x_hif_ops
    
    This is a preliminary patch to introduce WiFi7 chipset support
    
    Signed-off-by: Lorenzo Bianconi <lorenzo@kernel.org>
    Signed-off-by: Deren Wu <deren.wu@mediatek.com>
    Signed-off-by: Felix Fietkau <nbd@nbd.name>

commit 975e122ddb7cd6f67bff974d2ea00c5568d2014c
Author: Lorenzo Bianconi <lorenzo@kernel.org>
Date:   Wed Jun 28 15:05:52 2023 +0800

    wifi: mt76: mt7921: rename mt7921_dev in mt792x_dev
    
    This is a preliminary patch to introduce WiFi7 chipset support
    
    Signed-off-by: Lorenzo Bianconi <lorenzo@kernel.org>
    Signed-off-by: Deren Wu <deren.wu@mediatek.com>
    Signed-off-by: Felix Fietkau <nbd@nbd.name>

commit 78562b2cafc61a0c08dc949eacb942ac756aae37
Author: Lorenzo Bianconi <lorenzo@kernel.org>
Date:   Wed Jun 28 15:05:51 2023 +0800

    wifi: mt76: mt7921: rename mt7921_phy in mt792x_phy
    
    This is a preliminary patch to introduce WiFi7 chipset support
    
    Signed-off-by: Lorenzo Bianconi <lorenzo@kernel.org>
    Signed-off-by: Deren Wu <deren.wu@mediatek.com>
    Signed-off-by: Felix Fietkau <nbd@nbd.name>

commit b7bfad2c83cdbbd7cd502bebdc75ef703c980634
Author: Lorenzo Bianconi <lorenzo@kernel.org>
Date:   Wed Jun 28 15:05:50 2023 +0800

    wifi: mt76: mt7921: rename mt7921_sta in mt792x_sta
    
    This is a preliminary patch to introduce WiFi7 chipset support
    
    Signed-off-by: Lorenzo Bianconi <lorenzo@kernel.org>
    Signed-off-by: Deren Wu <deren.wu@mediatek.com>
    Signed-off-by: Felix Fietkau <nbd@nbd.name>

commit 15ca8970efdbe9e9cc56d334ad1556840d6f77a2
Author: Lorenzo Bianconi <lorenzo@kernel.org>
Date:   Wed Jun 28 15:05:49 2023 +0800

    wifi: mt76: mt7921: rename mt7921_vif in mt792x_vif
    
    This is a preliminary patch to introduce WiFi7 chipset support
    
    Signed-off-by: Lorenzo Bianconi <lorenzo@kernel.org>
    Signed-off-by: Deren Wu <deren.wu@mediatek.com>
    Signed-off-by: Felix Fietkau <nbd@nbd.name>

commit 95a686dcaea0948d2e98fcac7f79df91c56d2f21
Author: Lorenzo Bianconi <lorenzo@kernel.org>
Date:   Wed Jun 28 15:05:48 2023 +0800

    wifi: mt76: mt7921: convert acpisar and clc pointers to void
    
    Convert acpisar and clc pointers in mt7921_dev structure to void.
    This is a preliminary patch to add WiFi7 chipset support
    
    Signed-off-by: Lorenzo Bianconi <lorenzo@kernel.org>
    Signed-off-by: Deren Wu <deren.wu@mediatek.com>
    Signed-off-by: Felix Fietkau <nbd@nbd.name>

commit 6db1b497b04e0e3dff755e0c2a6644c2379d32e2
Author: Lorenzo Bianconi <lorenzo@kernel.org>
Date:   Wed Jun 28 15:05:47 2023 +0800

    wifi: mt76: mt7921: move common register definition in mt792x_regs.h
    
    This is a preliminary patch in order to support new WiFi7 chips.
    
    Signed-off-by: Lorenzo Bianconi <lorenzo@kernel.org>
    Signed-off-by: Deren Wu <deren.wu@mediatek.com>
    Signed-off-by: Felix Fietkau <nbd@nbd.name>

commit fe0ea395f0a35103f61e107b227bf8bc4b9765df
Author: Felix Fietkau <nbd@nbd.name>
Date:   Tue Jul 25 21:06:03 2023 +0200

    wifi: mt76: mt7603: fix tx filter/flush function
    
    Setting MT_TX_ABORT does not abort any transmission for a wtbl index on its
    own. Instead, it modifies the behavior of a queue flush to make it selectively
    flush packets for a particular wtbl index.
    Adjust powersave filtering to make use of this in order to avoid running into
    unnecessary timeouts while flushing
    
    Signed-off-by: Felix Fietkau <nbd@nbd.name>

commit f090d0ca0de92aa378f342011d16f5d310a8383f
Author: Felix Fietkau <nbd@nbd.name>
Date:   Tue Jul 25 12:37:59 2023 +0200

    wifi: mt76: mt7603: fix beacon interval after disabling a single vif
    
    When disabling beacons on a vif, intval is 0. Ensure that dev->mt76.beacon_int
    is not overwritten in this case, so that beacons continue to work for other
    interfaces.
    
    Signed-off-by: Felix Fietkau <nbd@nbd.name>

commit 3ec5ac12ac8a4e6b1e085374325a5fbd1b650fd5
Author: Felix Fietkau <nbd@nbd.name>
Date:   Fri Jul 14 10:57:15 2023 +0200

    wifi: mt76: mt7915: remove VHT160 capability on MT7915
    
    The IEEE80211_VHT_CAP_EXT_NSS_BW value already indicates support for half-NSS
    160 MHz support, so it is wrong to also advertise full 160 MHz support.
    
    Fixes: c2f73eacee3b ("wifi: mt76: mt7915: add back 160MHz channel width support for MT7915")
    Signed-off-by: Felix Fietkau <nbd@nbd.name>

commit 5bef3a406c6e7c4a1d5db69938a08ea70aa9c388
Author: Christian Marangi <ansuelsmth@gmail.com>
Date:   Sat Jul 8 20:29:36 2023 +0200

    wifi: mt76: add support for providing eeprom in nvmem cells
    
    Add support for providing eeprom in nvmem cells by adding nvmem cell as
    an alternative source for mt76_get_of_eeprom().
    
    Nvmem cells will follow standard nvmem cell definition and needs to be
    called 'eeprom' to be correctly identified.
    
    Signed-off-by: Christian Marangi <ansuelsmth@gmail.com>
    Reviewed-by: Daniel Golle <daniel@makrotopia.org>
    Tested-by: Daniel Golle <daniel@makrotopia.org>
    Signed-off-by: Felix Fietkau <nbd@nbd.name>

commit 7d424a990e050ac09a0646edca083dcb4a516855
Author: Christian Marangi <ansuelsmth@gmail.com>
Date:   Sat Jul 8 20:29:35 2023 +0200

    wifi: mt76: split get_of_eeprom in subfunction
    
    In preparation for NVMEM support, split get_of_eeprom() in subfunction
    to tidy the code and facilitate the addition of alternative method to
    get eeprom data. No behaviour change intended.
    
    While at it also drop OF ifdef checks as OF have stubs and calling
    of_get_property would result in the same error returned.
    
    Signed-off-by: Christian Marangi <ansuelsmth@gmail.com>
    Reviewed-by: Daniel Golle <daniel@makrotopia.org>
    Tested-by: Daniel Golle <daniel@makrotopia.org>
    Signed-off-by: Felix Fietkau <nbd@nbd.name>

commit 02a894046d5ab7d0010f39ea54fde7e167919d04
Author: Felix Fietkau <nbd@nbd.name>
Date:   Thu Jun 29 22:39:30 2023 +0200

    wifi: mt76: mt7915: fix capabilities in non-AP mode
    
    Capabilities in vif->bss_conf are only initialized in AP mode.
    For other modes, they should be enabled by default, in order to avoid a
    mismatch.
    
    Fixes: 885f7af7e544 ("wifi: mt76: mt7915: remove mt7915_mcu_beacon_check_caps()")
    Signed-off-by: Felix Fietkau <nbd@nbd.name>

commit 46d3304d6552d6dfd715e66b4c28e7c70bedd2f7
Author: Lorenzo Bianconi <lorenzo@kernel.org>
Date:   Thu Jun 22 18:50:32 2023 +0200

    wifi: mt76: connac: add connac3 mac library
    
    Introduce connac3_mac in mt76_connac library to reuse mac code shared
    between WiFi7 chipsets. So far connac3 library contains just radiotap
    parsing code.
    
    Signed-off-by: Lorenzo Bianconi <lorenzo@kernel.org>
    Signed-off-by: Felix Fietkau <nbd@nbd.name>

commit 0cb065b9ade9cab8be3a75e8b1b734133c355b82
Author: Lorenzo Bianconi <lorenzo@kernel.org>
Date:   Thu Jun 22 18:50:30 2023 +0200

    wifi: mt76: move rate info in mt76_vif
    
    This is a preliminary patch to introduce mt76_connac3 mac library used
    by WiFi7 chipsets (e.g. mt7996).
    
    Signed-off-by: Lorenzo Bianconi <lorenzo@kernel.org>
    Signed-off-by: Felix Fietkau <nbd@nbd.name>

commit c8e370feb361896376acc871e68408613034437b
Author: Lorenzo Bianconi <lorenzo@kernel.org>
Date:   Thu Jun 22 18:50:29 2023 +0200

    mt76: connac: move more mt7921/mt7915 mac shared code in connac lib
    
    Move the following routines in mt76-connac lib since they are shared
    between mt7915 and mt7921:
    - mt76_connac2_tx_check_aggr
    - mt76_connac2_txwi_free
    - mt76_connac2_tx_token_put
    
    Signed-off-by: Lorenzo Bianconi <lorenzo@kernel.org>
    Signed-off-by: Felix Fietkau <nbd@nbd.name>

commit ef591d74d4ba1273100d790f79059384f4547857
Author: Lorenzo Bianconi <lorenzo@kernel.org>
Date:   Thu Jun 22 18:50:28 2023 +0200

    wifi: mt76: move ampdu_state in mt76_wcid
    
    ampdu_state field is used by most of the drivers, so move it in
    mt76_wcid structure.
    
    Signed-off-by: Lorenzo Bianconi <lorenzo@kernel.org>
    Signed-off-by: Felix Fietkau <nbd@nbd.name>

commit d17a2fe830d7c458166a06ca222ed7f4d94c671f
Author: Lorenzo Bianconi <lorenzo@kernel.org>
Date:   Thu Jun 22 18:50:27 2023 +0200

    wifi: mt76: mt7921: rely on shared poll_list field
    
    Rely on poll_list field in mt76_wcid structure and get rid of
    private copy.
    
    Signed-off-by: Lorenzo Bianconi <lorenzo@kernel.org>
    Signed-off-by: Felix Fietkau <nbd@nbd.name>

commit 9d599f2d654639198478fb6e0a8bd381b283730e
Author: Lorenzo Bianconi <lorenzo@kernel.org>
Date:   Thu Jun 22 18:50:25 2023 +0200

    wifi: mt76: mt7615: rely on shared poll_list field
    
    Rely on poll_list field in mt76_wcid structure and get rid of
    private copy.
    
    Signed-off-by: Lorenzo Bianconi <lorenzo@kernel.org>
    Signed-off-by: Felix Fietkau <nbd@nbd.name>

commit 2d29058e396a273ebb681559b135ff8bcb005e7c
Author: Lorenzo Bianconi <lorenzo@kernel.org>
Date:   Thu Jun 22 18:50:24 2023 +0200

    wifi: mt76: mt7603: rely on shared poll_list field
    
    Rely on poll_list field in mt76_wcid structure and get rid of
    private copy.
    
    Signed-off-by: Lorenzo Bianconi <lorenzo@kernel.org>
    Signed-off-by: Felix Fietkau <nbd@nbd.name>

commit b73e1d9245eba06012792cd3c9ca96dad23904ee
Author: Lorenzo Bianconi <lorenzo@kernel.org>
Date:   Thu Jun 22 18:50:23 2023 +0200

    wifi: mt76: mt7915: move poll_list in mt76_wcid
    
    poll_list field is used by most of the drivers, so move it in mt76_wcid
    structure.
    
    Signed-off-by: Lorenzo Bianconi <lorenzo@kernel.org>
    Signed-off-by: Felix Fietkau <nbd@nbd.name>

commit 419acc515dd32039da1ac48b13077912e9b1c2c4
Author: Lorenzo Bianconi <lorenzo@kernel.org>
Date:   Thu Jun 22 18:50:22 2023 +0200

    wifi: mt76: mt7921: rely on shared sta_poll_list and sta_poll_lock
    
    Rely on sta_poll_list and sta_poll_lock fields in mt76_dev structure
    and get rid of private copies.
    
    Signed-off-by: Lorenzo Bianconi <lorenzo@kernel.org>
    Signed-off-by: Felix Fietkau <nbd@nbd.name>

commit 57a3fac664ce192359271d7f6ddf1d55dff80cbc
Author: Lorenzo Bianconi <lorenzo@kernel.org>
Date:   Thu Jun 22 18:50:20 2023 +0200

    wifi: mt76: mt7615: rely on shared sta_poll_list and sta_poll_lock
    
    Rely on sta_poll_list and sta_poll_lock fields in mt76_dev structure
    and get rid of private copies.
    
    Signed-off-by: Lorenzo Bianconi <lorenzo@kernel.org>
    Signed-off-by: Felix Fietkau <nbd@nbd.name>

commit c55e898bd9ca980e3e68152e7630aacf517c1648
Author: Lorenzo Bianconi <lorenzo@kernel.org>
Date:   Thu Jun 22 18:50:19 2023 +0200

    wifi: mt76: mt7603: rely on shared sta_poll_list and sta_poll_lock
    
    Rely on sta_poll_list and sta_poll_lock fields in mt76_dev structure
    and get rid of private copies.
    
    Signed-off-by: Lorenzo Bianconi <lorenzo@kernel.org>
    Signed-off-by: Felix Fietkau <nbd@nbd.name>

commit fbba711c3de73c57b476767ba0d5ae1e8b2faa8f
Author: Lorenzo Bianconi <lorenzo@kernel.org>
Date:   Thu Jun 22 18:50:18 2023 +0200

    wifi: mt76: mt7915: move sta_poll_list and sta_poll_lock in mt76_dev
    
    sta_poll_list and sta_poll_lock are used by most of the drivers, so move
    them in mt76_dev structure.
    
    Signed-off-by: Lorenzo Bianconi <lorenzo@kernel.org>
    Signed-off-by: Felix Fietkau <nbd@nbd.name>

commit 94f096a14af2647d875ae6a9a09d32eb43393184
Author: MeiChia Chiu <MeiChia.Chiu@mediatek.com>
Date:   Mon Jun 5 23:21:40 2023 +0800

    wifi: mt76: mt7996: add muru support
    
    Add sta_rec_muru() fw command to support MU-MIMO and OFDMA features.
    
    Signed-off-by: MeiChia Chiu <meichia.chiu@mediatek.com>
    Signed-off-by: Shayne Chen <shayne.chen@mediatek.com>
    Signed-off-by: Felix Fietkau <nbd@nbd.name>

commit 83a10ae2d4c5b00fd597a7a7a5e7ceefef9bd116
Author: Peter Chiu <chui-hao.chiu@mediatek.com>
Date:   Mon Jun 5 23:21:37 2023 +0800

    wifi: mt76: connac: add support to set ifs time by mcu command
    
    There's a race between driver and fw on some tx/rx control registers
    when setting ifs, which will cause accidental hw queue pause problems.
    Avoid this by setting ifs time with bss_info mcu command.
    
    Reviewed-by: Shayne Chen <shayne.chen@mediatek.com>
    Signed-off-by: Peter Chiu <chui-hao.chiu@mediatek.com>
    Signed-off-by: Shayne Chen <shayne.chen@mediatek.com>
    Signed-off-by: Felix Fietkau <nbd@nbd.name>

commit a32f063dfbe38a70cd670cdc2266b9fafdc998a8
Author: Peter Chiu <chui-hao.chiu@mediatek.com>
Date:   Mon Jun 5 23:21:33 2023 +0800

    wifi: mt76: connac: add support for dsp firmware download
    
    Add FW_START_WORKING_PDA_DSP for the indication of starting DSP
    firmware download, which is for phy-related control.
    The firmware is transparent to the driver, but it's necessary for the
    firmware download process.
    
    Reviewed-by: Shayne Chen <shayne.chen@mediatek.com>
    Signed-off-by: Peter Chiu <chui-hao.chiu@mediatek.com>
    Signed-off-by: Shayne Chen <shayne.chen@mediatek.com>
    Signed-off-by: Felix Fietkau <nbd@nbd.name>

commit f124ed65ab185ef6148b4cdc4207a5b0a0faa206
Author: Lorenzo Bianconi <lorenzo@kernel.org>
Date:   Mon Jun 5 08:51:43 2023 +0200

    wifi: mt76: mt7921: get rid of MT7921_RESET_TIMEOUT marco
    
    MT7921_RESET_TIMEOUT is never used, so get rid of it.
    
    Signed-off-by: Lorenzo Bianconi <lorenzo@kernel.org>
    Signed-off-by: Felix Fietkau <nbd@nbd.name>

commit c4f0755823045b66484fb53d686f85d3151400f4
Author: Rany Hany <rany_hany@riseup.net>
Date:   Sun May 28 21:04:28 2023 +0300

    wifi: mt76: mt7915: fix command timeout in AP stop period
    
    Due to AP stop improperly, mt7915 driver would face random command timeout
    by chip fw problem. Migrate AP start/stop process to .start_ap/.stop_ap and
    congiure BSS network settings in both hooks.
    
    The new flow is shown below.
    * AP start
        .start_ap()
          configure BSS network resource
          set BSS to connected state
        .bss_info_changed()
          enable fw beacon offload
    
    * AP stop
        .bss_info_changed()
          disable fw beacon offload (skip this command)
        .stop_ap()
          set BSS to disconnected state (beacon offload disabled automatically)
          destroy BSS network resource
    
    Based on "mt76: mt7921: fix command timeout in AP stop period"
    
    Signed-off-by: Rany Hany <rany_hany@riseup.net>
    Signed-off-by: Felix Fietkau <nbd@nbd.name>

commit 0dde9c11cf58c1720556c778737d28d1945c8e07
Author: Lorenzo Bianconi <lorenzo@kernel.org>
Date:   Sat May 27 13:23:46 2023 +0200

    wifi: mt76: mt7921: make mt7921_mac_sta_poll static
    
    Make mt7921_mac_sta_poll static since it is run just in mac.c
    
    Signed-off-by: Lorenzo Bianconi <lorenzo@kernel.org>
    Reviewed-by: Simon Horman <simon.horman@corigine.com>
    Signed-off-by: Felix Fietkau <nbd@nbd.name>

commit 1e64fdd41c9d2c6f6c9ef0ce7d6854c70d812d0f
Author: Bo Jiao <Bo.Jiao@mediatek.com>
Date:   Tue May 23 02:49:53 2023 +0800

    wifi: mt76: mt7915: disable WFDMA Tx/Rx during SER recovery
    
    Stop WFDMA transaction to avoid potential unexpected issue while doing
    system recovery.
    
    Signed-off-by: Bo Jiao <Bo.Jiao@mediatek.com>
    Signed-off-by: Ryder Lee <ryder.lee@mediatek.com>
    Signed-off-by: Felix Fietkau <nbd@nbd.name>

commit 6ae39b7c7ed4d594cacb6b1d61fb6a8602df0c3c
Author: Ben Greear <greearb@candelatech.com>
Date:   Fri Jun 2 14:14:24 2023 -0700

    wifi: mt76: mt7921: Support temp sensor
    
    Allow sensors tool to read radio's temperature, example:
    
    mt7921_phy17-pci-1800
    Adapter: PCI adapter
    temp1:        +72.0°C
    
    Signed-off-by: Ben Greear <greearb@candelatech.com>
    Signed-off-by: Felix Fietkau <nbd@nbd.name>

commit 0e5911bb7cc92c00dda9b4d635c1266b7ca915c6
Author: Ming Yen Hsieh <mingyen.hsieh@mediatek.com>
Date:   Thu May 18 22:08:14 2023 +0800

    wifi: mt76: mt7921: fix non-PSC channel scan fail
    
    Due to the scan command may only request legacy bands and PSC channel
    in 6GHz band, we are unable to scan the APs on non-PSC channel in this
    case. Enable WIPHY_FLAG_SPLIT_SCAN_6GHZ to support non-PSC channel
    (obtained during scan on legacy bands) in 6GHz scan request.
    
    Fixes: 50ac15a511e3 ("mt76: mt7921: add 6GHz support")
    Signed-off-by: Ming Yen Hsieh <mingyen.hsieh@mediatek.com>
    Signed-off-by: Deren Wu <deren.wu@mediatek.com>
    Signed-off-by: Felix Fietkau <nbd@nbd.name>

commit 1258c156f2537786468c7fe04f547f64c97c1e12
Author: Ryder Lee <ryder.lee@mediatek.com>
Date:   Thu May 18 01:34:43 2023 +0800

    wifi: mt76: mt7915: accumulate mu-mimo ofdma muru stats
    
    The stats are clear-on-read, which makes it very difficult for tools
    to adequately deal with wrapped stats and with keeping good totals.
    
    So, accumulate these values when they are read from the firmware/radio
    and present totals to user-space.
    
    Signed-off-by: Ben Greear <greearb@candelatech.com>
    Signed-off-by: Ryder Lee <ryder.lee@mediatek.com>
    Signed-off-by: Felix Fietkau <nbd@nbd.name>

commit 749c2c2b29dfb3a41cfdf9942581c2524664e969
Author: Ryder Lee <ryder.lee@mediatek.com>
Date:   Thu May 18 01:34:42 2023 +0800

    wifi: mt76: add tx_nss histogram to ethtool stats
    
    mt76_connac2_mac_fill_txs() counts tx_nss but ethtool doesn't show
    stats. Add missing histogram accordingly.
    
    Signed-off-by: Ben Greear <greearb@candelatech.com>
    Signed-off-by: Ryder Lee <ryder.lee@mediatek.com>
    Signed-off-by: Felix Fietkau <nbd@nbd.name>

commit b642f4c5f3de0a8f47808d32b1ebd9c427a42a66
Author: Deren Wu <deren.wu@mediatek.com>
Date:   Wed May 17 17:18:24 2023 +0800

    wifi: mt76: mt7921: fix skb leak by txs missing in AMSDU
    
    txs may be dropped if the frame is aggregated in AMSDU. When the problem
    shows up, some SKBs would be hold in driver to cause network stopped
    temporarily. Even if the problem can be recovered by txs timeout handling,
    mt7921 still need to disable txs in AMSDU to avoid this issue.
    
    Cc: stable@vger.kernel.org
    Fixes: 163f4d22c118 ("mt76: mt7921: add MAC support")
    Reviewed-by: Shayne Chen <shayne.chen@mediatek.com>
    Signed-off-by: Deren Wu <deren.wu@mediatek.com>
    Reviewed-by: Simon Horman <simon.horman@corigine.com>
    Signed-off-by: Felix Fietkau <nbd@nbd.name>

commit 9aecfa754c7fc12c3f7feb669aec2f744e83954a
Author: Deren Wu <deren.wu@mediatek.com>
Date:   Mon May 15 23:18:50 2023 +0800

    wifi: mt76: mt7921e: report tx retries/failed counts in tx free event
    
    Get missing tx retries/failed counts from txfree done events and report
    them via mt7921_sta_statistics().
    
    Signed-off-by: Deren Wu <deren.wu@mediatek.com>
    Reviewed-by: Sean Wang <sean.wang@mediatek.com>
    Signed-off-by: Felix Fietkau <nbd@nbd.name>

commit 6bad146d162e92174b09522b357b64f8fda95246
Author: Alexander Couzens <lynxis@fe80.eu>
Date:   Mon May 15 15:27:12 2023 +0200

    wifi: mt76: mt7915: add support for MT7981
    
    Add support for the MediaTek MT7981 SoC which is similar to the MT7986
    but with a newer IP cores and only 2x ARM Cortex-A53 instead of 4x.
    Unlike MT7986 the MT7981 can only connect a single wireless frontend,
    usually MT7976 is used for DBDC.
    
    Signed-off-by: Alexander Couzens <lynxis@fe80.eu>
    Signed-off-by: Daniel Golle <daniel@makrotopia.org>
    Reviewed-by: Simon Horman <simon.horman@corigine.com>
    Signed-off-by: Felix Fietkau <nbd@nbd.name>

commit 52a1f158b3ff76d6501c061e3c6952801a2dc9a7
Author: Lorenzo Bianconi <lorenzo@kernel.org>
Date:   Sat May 13 00:29:55 2023 +0200

    wifi: mt76: mt7921: rely on mib_stats shared definition
    
    Get rid of private copy of mib_stats structure.
    
    Signed-off-by: Lorenzo Bianconi <lorenzo@kernel.org>
    Reviewed-by: Simon Horman <simon.horman@corigine.com>
    Signed-off-by: Felix Fietkau <nbd@nbd.name>

commit 7f03a56314be00f0ecfa3ef27559d6cfa6ba0429
Author: Lorenzo Bianconi <lorenzo@kernel.org>
Date:   Sat May 13 00:29:53 2023 +0200

    wifi: mt76: mt7915: move mib_stats structure in mt76.h
    
    mib_stats structure is shared by mostly all chipsets. Move it to shared
    code.
    
    Signed-off-by: Lorenzo Bianconi <lorenzo@kernel.org>
    Reviewed-by: Simon Horman <simon.horman@corigine.com>
    Signed-off-by: Felix Fietkau <nbd@nbd.name>

commit 692031b9045ca0739232052d0cdb26a5d4e5b4b5
Author: Lorenzo Bianconi <lorenzo@kernel.org>
Date:   Fri May 12 15:11:58 2023 +0200

    wifi: mt76: mt7921: remove macro duplication in regs.h
    
    Get rid of MT_MIB_RTS_COUNT_MASK marco duplication in mt7921/regs.h
    
    Signed-off-by: Lorenzo Bianconi <lorenzo@kernel.org>
    Reviewed-by: Simon Horman <simon.horman@corigine.com>
    Signed-off-by: Felix Fietkau <nbd@nbd.name>

commit d616d3680264beb9a9d2c4fc681064b06f447eeb
Author: Deren Wu <deren.wu@mediatek.com>
Date:   Wed May 10 14:51:13 2023 +0800

    wifi: mt76: mt7921: do not support one stream on secondary antenna only
    
    mt7921 support following antenna combiantions only.
    * primary + secondary (2x2)
    * primary only        (1x1)
    
    Since we cannot work on secondary antenna only, return error if the
    antenna bitmap is 0x2 in .set_antenna().
    
    For example:
    iw phy0 set antenna 3 3 /* valid */
    iw phy0 set antenna 1 1 /* valid */
    iw phy0 set antenna 2 2 /* invalid */
    
    Cc: stable@vger.kernel.org
    Fixes: e0f9fdda81bd ("mt76: mt7921: add ieee80211_ops")
    Suggested-by: Knox Chiou <knoxchiou@google.com>
    Signed-off-by: Deren Wu <deren.wu@mediatek.com>
    Signed-off-by: Felix Fietkau <nbd@nbd.name>

commit 41bc54404687faa05404df0910890b062c705f54
Author: Ryder Lee <ryder.lee@mediatek.com>
Date:   Wed May 10 12:53:20 2023 +0800

    wifi: mt76: mt7915: drop return in mt7915_sta_statistics
    
    Avoid blocking other statistics sinfo->filled when txrate is
    unavailable.
    
    Signed-off-by: Ryder Lee <ryder.lee@mediatek.com>
    Signed-off-by: Felix Fietkau <nbd@nbd.name>

commit e890c3cf7897b1d07b19124ad2e42c687b3b99e5
Author: Peter Chiu <chui-hao.chiu@mediatek.com>
Date:   Wed May 10 12:53:19 2023 +0800

    wifi: mt76: report non-binding skb tx rate when WED is active
    
    AQL relies on accurate tx rate reporting, so add this patch for
    non-binding skb rate when WED is enabled.
    
    Co-developed-by: Ryder Lee <ryder.lee@mediatek.com>
    Signed-off-by: Ryder Lee <ryder.lee@mediatek.com>
    Signed-off-by: Peter Chiu <chui-hao.chiu@mediatek.com>
    Signed-off-by: Felix Fietkau <nbd@nbd.name>

commit f39d499345dddb8382986fd5a2a0e84a63b1a6d5
Author: Peter Chiu <chui-hao.chiu@mediatek.com>
Date:   Wed May 10 12:53:18 2023 +0800

    wifi: mt76: mt7915: rework tx bytes counting when WED is active
    
    Concurrent binding/non-binding skbs could be handled anywhere which leads
    to mixed byte counting, so switch to use PPDU TxS reporting regardless Tx
    paths when WED is active.
    
    Fixes: 43eaa3689507 ("wifi: mt76: add PPDU based TxS support for WED device")
    Co-developed-by: Ryder Lee <ryder.lee@mediatek.com>
    Signed-off-by: Ryder Lee <ryder.lee@mediatek.com>
    Signed-off-by: Peter Chiu <chui-hao.chiu@mediatek.com>
    Signed-off-by: Felix Fietkau <nbd@nbd.name>

commit 161a7528e4074d104305fc109c16134b4990070e
Author: Peter Chiu <chui-hao.chiu@mediatek.com>
Date:   Wed May 10 12:53:17 2023 +0800

    wifi: mt76: mt7915: rework tx packets counting when WED is active
    
    PPDU TxS can only report MPDU count whereas mac80211 requires MSDU scale
    (NL80211_STA_INFO_TX_PACKETS), so switch to get MSDU counts from WA
    statistic.
    
    Note that mt7915 WA firmware only counts tx_packet for WED path, so driver
    needs to take care of host path additionally.
    
    Fixes: 43eaa3689507 ("wifi: mt76: add PPDU based TxS support for WED device")
    Co-developed-by: Ryder Lee <ryder.lee@mediatek.com>
    Signed-off-by: Ryder Lee <ryder.lee@mediatek.com>
    Signed-off-by: Peter Chiu <chui-hao.chiu@mediatek.com>
    Signed-off-by: Felix Fietkau <nbd@nbd.name>

commit 943e4fb96e6f47c70a0a9d29d62cffc2479330e6
Author: Ryder Lee <ryder.lee@mediatek.com>
Date:   Wed May 10 12:53:16 2023 +0800

    wifi: mt76: mt7915: report tx retries/failed counts for non-WED path
    
    Get missing tx retries/failed counts from txfree done events and report
    them via mt7915_sta_statistics().
    
    Co-developed-by: Peter Chiu <chui-hao.chiu@mediatek.com>
    Signed-off-by: Peter Chiu <chui-hao.chiu@mediatek.com>
    Signed-off-by: Ryder Lee <ryder.lee@mediatek.com>
    Signed-off-by: Felix Fietkau <nbd@nbd.name>

commit 9a3994077d170ec9ac75e800932b5671d9940cd2
Author: StanleyYP Wang <StanleyYP.Wang@mediatek.com>
Date:   Tue May 9 11:11:57 2023 +0800

    wifi: mt76: mt7915: fix background radar event being blocked
    
    The background radar uses MT_RX_SEL2 as its band indication, so fix it.
    
    Fixes: 7a53eecd5c87 (wifi: mt76: mt7915: check the correctness of event data)
    Signed-off-by: StanleyYP Wang <StanleyYP.Wang@mediatek.com>
    Signed-off-by: Ryder Lee <ryder.lee@mediatek.com>
    Signed-off-by: Felix Fietkau <nbd@nbd.name>

commit 62561a47af587a863583ce1d607b519c0c4bb384
Author: Ryder Lee <ryder.lee@mediatek.com>
Date:   Sat May 6 13:46:19 2023 +0800

    wifi: mt76: enable UNII-4 channel 177 support
    
    Enable support for the 5GHz channel 177 with center frequency 5885MHz and
    operating class 125 based on IEEE Std 802.11ax-2021 Table E-4.
    
    Signed-off-by: Himanshu Goyal <himanshu.goyal@mediatek.com>
    Signed-off-by: Ryder Lee <ryder.lee@mediatek.com>
    Signed-off-by: Felix Fietkau <nbd@nbd.name>

commit 905a0a6ac7a7709d3ac98ca8c98ca27dd1567b9b
Author: Ryder Lee <ryder.lee@mediatek.com>
Date:   Tue May 2 11:10:06 2023 +0800

    wifi: mt76: mt7615: enable BSS_CHANGED_MU_GROUPS support
    
    The Group ID Management frame is an Action frame of category VHT.
    It is transmitted by the AP to assign or change the user position
    of a STA for one or more group IDs.
    
    Also, sniffer can use a given group id to monitor STA that belongs
    to that group.
    
    Notify underlying driver of changes via BSS_CHANGED_MU_GROUPS.
    
    Signed-off-by: Ryder Lee <ryder.lee@mediatek.com>
    Signed-off-by: Felix Fietkau <nbd@nbd.name>

commit 98c4d0abf5c478db1ad126ff0c187dbb84c0803c
Author: Matt Whitlock <kernel@mattwhitlock.name>
Date:   Thu Apr 20 15:24:51 2023 -0400

    mt76: mt7921: don't assume adequate headroom for SDIO headers
    
    mt7921_usb_sdio_tx_prepare_skb() calls mt7921_usb_sdio_write_txwi() and
    mt7921_skb_add_usb_sdio_hdr(), both of which blindly assume that
    adequate headroom will be available in the passed skb. This assumption
    typically is satisfied when the skb was allocated in the net core for
    transmission via the mt7921 netdev (although even that is only an
    optimization and is not strictly guaranteed), but the assumption is
    sometimes not satisfied when the skb originated in the receive path of
    another netdev and was passed through to the mt7921, such as by the
    bridge layer. Blindly prepending bytes to an skb is always wrong.
    
    This commit introduces a call to skb_cow_head() before the call to
    mt7921_usb_sdio_write_txwi() in mt7921_usb_sdio_tx_prepare_skb() to
    ensure that at least MT_SDIO_TXD_SIZE + MT_SDIO_HDR_SIZE bytes can be
    pushed onto the skb.
    
    Without this fix, I can trivially cause kernel panics by bridging an
    MT7921AU-based USB 802.11ax interface with an Ethernet interface on an
    Intel Atom-based x86 system using its onboard RTL8169 PCI Ethernet
    adapter and also on an ARM-based Raspberry Pi 1 using its onboard
    SMSC9512 USB Ethernet adapter. Note that the panics do not occur in
    every system configuration, as they occur only if the receiving netdev
    leaves less headroom in its received skbs than the mt7921 needs for its
    SDIO headers.
    
    Here is an example stack trace of this panic on Raspberry Pi OS Lite
    2023-02-21 running kernel 6.1.24+ [1]:
    
     skb_panic from skb_push+0x44/0x48
     skb_push from mt7921_usb_sdio_tx_prepare_skb+0xd4/0x190 [mt7921_common]
     mt7921_usb_sdio_tx_prepare_skb [mt7921_common] from mt76u_tx_queue_skb+0x94/0x1d0 [mt76_usb]
     mt76u_tx_queue_skb [mt76_usb] from __mt76_tx_queue_skb+0x4c/0xc8 [mt76]
     __mt76_tx_queue_skb [mt76] from mt76_txq_schedule.part.0+0x13c/0x398 [mt76]
     mt76_txq_schedule.part.0 [mt76] from mt76_txq_schedule_all+0x24/0x30 [mt76]
     mt76_txq_schedule_all [mt76] from mt7921_tx_worker+0x58/0xf4 [mt7921_common]
     mt7921_tx_worker [mt7921_common] from __mt76_worker_fn+0x9c/0xec [mt76]
     __mt76_worker_fn [mt76] from kthread+0xbc/0xe0
     kthread from ret_from_fork+0x14/0x34
    
    After this fix, bridging the mt7921 interface works fine on both of my
    previously problematic systems.
    
    [1] https://github.com/raspberrypi/firmware/tree/5c276f55a4b21345cd4d6200a504ee991851ff7a
    
    Link: https://github.com/openwrt/openwrt/issues/11796
    Signed-off-by: Matt Whitlock <kernel@mattwhitlock.name>
    Signed-off-by: Felix Fietkau <nbd@nbd.name>

commit 421033deb91521aa6a9255e495cb106741a52275
Author: Paul Fertser <fercerpav@gmail.com>
Date:   Mon Jun 5 10:34:07 2023 +0300

    wifi: mt76: mt7615: do not advertise 5 GHz on first phy of MT7615D (DBDC)
    
    On DBDC devices the first (internal) phy is only capable of using
    2.4 GHz band, and the 5 GHz band is exposed via a separate phy object,
    so avoid the false advertising.
    
    Reported-by: Rani Hod <rani.hod@gmail.com>
    Closes: https://github.com/openwrt/openwrt/pull/12361
    Fixes: 7660a1bd0c22 ("mt76: mt7615: register ext_phy if DBDC is detected")
    Cc: stable@vger.kernel.org
    Signed-off-by: Paul Fertser <fercerpav@gmail.com>
    Reviewed-by: Simon Horman <simon.horman@corigine.com>
    Acked-by: Felix Fietkau <nbd@nbd.name>
    Signed-off-by: Kalle Valo <kvalo@kernel.org>
    Link: https://lore.kernel.org/r/20230605073408.8699-1-fercerpav@gmail.com

commit 525c469e5de9bf7e53574396196e80fc716ac9eb
Author: Quan Zhou <quan.zhou@mediatek.com>
Date:   Wed Jul 5 23:26:38 2023 +0800

    wifi: mt76: mt7921e: fix init command fail with enabled device
    
    For some cases as below, we may encounter the unpreditable chip stats
    in driver probe()
    * The system reboot flow do not work properly, such as kernel oops while
      rebooting, and then the driver do not go back to default status at
      this moment.
    * Similar to the flow above. If the device was enabled in BIOS or UEFI,
      the system may switch to Linux without driver fully shutdown.
    
    To avoid the problem, force push the device back to default in probe()
    * mt7921e_mcu_fw_pmctrl() : return control privilege to chip side.
    * mt7921_wfsys_reset()    : cleanup chip config before resource init.
    
    Error log
    [59007.600714] mt7921e 0000:02:00.0: ASIC revision: 79220010
    [59010.889773] mt7921e 0000:02:00.0: Message 00000010 (seq 1) timeout
    [59010.889786] mt7921e 0000:02:00.0: Failed to get patch semaphore
    [59014.217839] mt7921e 0000:02:00.0: Message 00000010 (seq 2) timeout
    [59014.217852] mt7921e 0000:02:00.0: Failed to get patch semaphore
    [59017.545880] mt7921e 0000:02:00.0: Message 00000010 (seq 3) timeout
    [59017.545893] mt7921e 0000:02:00.0: Failed to get patch semaphore
    [59020.874086] mt7921e 0000:02:00.0: Message 00000010 (seq 4) timeout
    [59020.874099] mt7921e 0000:02:00.0: Failed to get patch semaphore
    [59024.202019] mt7921e 0000:02:00.0: Message 00000010 (seq 5) timeout
    [59024.202033] mt7921e 0000:02:00.0: Failed to get patch semaphore
    [59027.530082] mt7921e 0000:02:00.0: Message 00000010 (seq 6) timeout
    [59027.530096] mt7921e 0000:02:00.0: Failed to get patch semaphore
    [59030.857888] mt7921e 0000:02:00.0: Message 00000010 (seq 7) timeout
    [59030.857904] mt7921e 0000:02:00.0: Failed to get patch semaphore
    [59034.185946] mt7921e 0000:02:00.0: Message 00000010 (seq 8) timeout
    [59034.185961] mt7921e 0000:02:00.0: Failed to get patch semaphore
    [59037.514249] mt7921e 0000:02:00.0: Message 00000010 (seq 9) timeout
    [59037.514262] mt7921e 0000:02:00.0: Failed to get patch semaphore
    [59040.842362] mt7921e 0000:02:00.0: Message 00000010 (seq 10) timeout
    [59040.842375] mt7921e 0000:02:00.0: Failed to get patch semaphore
    [59040.923845] mt7921e 0000:02:00.0: hardware init failed
    
    Cc: stable@vger.kernel.org
    Fixes: 5c14a5f944b9 ("mt76: mt7921: introduce mt7921e support")
    Tested-by: Kai-Heng Feng <kai.heng.feng@canonical.com>
    Tested-by: Juan Martinez <juan.martinez@amd.com>
    Co-developed-by: Leon Yen <leon.yen@mediatek.com>
    Signed-off-by: Leon Yen <leon.yen@mediatek.com>
    Signed-off-by: Quan Zhou <quan.zhou@mediatek.com>
    Signed-off-by: Deren Wu <deren.wu@mediatek.com>
    Message-ID: <39fcb7cee08d4ab940d38d82f21897483212483f.1688569385.git.deren.wu@mediatek.com>
    Signed-off-by: Jakub Kicinski <kuba@kernel.org>

commit 30bc32c7c1f975cc3c14e1c7dc437266311282cf
Author: Lorenzo Bianconi <lorenzo@kernel.org>
Date:   Wed May 24 16:39:32 2023 +0200

    wifi: mt76: mt7615: fix possible race in mt7615_mac_sta_poll
    
    Grab sta_poll_lock spinlock in mt7615_mac_sta_poll routine in order to
    avoid possible races with mt7615_mac_add_txs() or mt7615_mac_fill_rx()
    removing msta pointer from sta_poll_list.
    
    Fixes: a621372a04ac ("mt76: mt7615: rework mt7615_mac_sta_poll for usb code")
    Signed-off-by: Lorenzo Bianconi <lorenzo@kernel.org>
    Signed-off-by: Kalle Valo <kvalo@kernel.org>
    Link: https://lore.kernel.org/r/48b23404b759de4f1db2ef85975c72a4aeb1097c.1684938695.git.lorenzo@kernel.org

commit c7ab7a29ef5c0779574120d922256ce4651555d3
Author: Ryder Lee <ryder.lee@mediatek.com>
Date:   Mon Apr 24 05:39:06 2023 +0800

    wifi: mt76: connac: fix stats->tx_bytes calculation
    
    The stats->tx_bytes shall subtract retry byte from tx byte.
    
    Fixes: 43eaa3689507 ("wifi: mt76: add PPDU based TxS support for WED device")
    Signed-off-by: Ryder Lee <ryder.lee@mediatek.com>
    Signed-off-by: Kalle Valo <kvalo@kernel.org>
    Link: https://lore.kernel.org/r/b3cd45596943cf5a06b2e08e2fe732ab0b51311b.1682285873.git.ryder.lee@mediatek.com

commit 230a167e094770fdcc104481719ef7b1a706fb27
Author: Felix Fietkau <nbd@nbd.name>
Date:   Thu Mar 30 11:07:52 2023 +0200

    wifi: mt76: set NL80211_EXT_FEATURE_CAN_REPLACE_PTK0 on supported drivers
    
    Drivers that do not generate IV/PN in software can safely rekey PTK0
    
    Signed-off-by: Felix Fietkau <nbd@nbd.name>

commit f4d63a87b527de258eec5bd6e9547f063d472b79
Author: Felix Fietkau <nbd@nbd.name>
Date:   Sat Dec 31 08:44:33 2022 +0100

    wifi: mt76: dma: use napi_build_skb
    
    Improves performance by using bulk allocation
    
    Signed-off-by: Felix Fietkau <nbd@nbd.name>

















































drivers/net/wireless/mediatek/mt76/mac80211.c:1070:26: error: use of undeclared identifier 'RX_ENC_EHT'
        if (status->encoding == RX_ENC_EHT) {
                                ^
drivers/net/wireless/mediatek/mt76/mac80211.c:1071:11: error: no member named 'eht' in 'struct ieee80211_rx_status'
                status->eht.ru = mstat.eht.ru;
                ~~~~~~  ^
drivers/net/wireless/mediatek/mt76/mac80211.c:1072:11: error: no member named 'eht' in 'struct ieee80211_rx_status'
                status->eht.gi = mstat.eht.gi;
                ~~~~~~  ^




















commit 885f7af7e54498e7168fa9e7c2f029f81988f933
Author: Ryder Lee <ryder.lee@mediatek.com>
Date:   Thu Feb 9 10:22:59 2023 +0800

    wifi: mt76: mt7915: remove mt7915_mcu_beacon_check_caps()
    
    Those capabilities have been added into ieee80211_bss_conf.
    
    Signed-off-by: Ryder Lee <ryder.lee@mediatek.com>
    Signed-off-by: Felix Fietkau <nbd@nbd.name>


































# this throws up a fight
commit 2c9abe653bc5134eeab411c46dde008d8a1c37b0
Author: Johannes Berg <johannes.berg@intel.com>
Date:   Fri Mar 31 16:59:08 2023 +0200

    wifi: ieee80211: correctly mark FTM frames non-bufferable
    
    The checks of whether or not a frame is bufferable were not
    taking into account that some action frames aren't, such as
    FTM. Check this, which requires some changes to the function
    ieee80211_is_bufferable_mmpdu() since we need the whole skb
    for the checks now.
    
    Reviewed-by: Ilan Peer <ilan.peer@intel.com>
    Signed-off-by: Johannes Berg <johannes.berg@intel.com>





































































# this one throws a conflict
commit 23dca7a90017ff2512c501f7da4c7ca7a95c2d6e
Author: Lorenzo Bianconi <lorenzo@kernel.org>
Date:   Thu Nov 24 16:22:55 2022 +0100

    net: ethernet: mtk_wed: add reset to tx_ring_setup callback
    
    Introduce reset parameter to mtk_wed_tx_ring_setup signature.
    This is a preliminary patch to add Wireless Ethernet Dispatcher reset
    support.
    
    Co-developed-by: Sujuan Chen <sujuan.chen@mediatek.com>
    Signed-off-by: Sujuan Chen <sujuan.chen@mediatek.com>
    Signed-off-by: Lorenzo Bianconi <lorenzo@kernel.org>
    Signed-off-by: Paolo Abeni <pabeni@redhat.com>
